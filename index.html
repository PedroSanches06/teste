<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hyundai Portal</title>
  <meta name="theme-color" content="#0b3d91" />

  <style>
    :root{
      --bg1:#f5f9ff;
      --bg2:#eaf2ff;
      --stroke:#e6efff;
      --text:#0a1b3a;
      --muted:#5c6e8a;
      --brand:#0b3d91;
      --brand2:#1e88ff;
      --brand3:#56c2ff;
      --danger:#e53935;
      --success:#2e7d32;
      --shadow: 0 18px 60px rgba(8, 36, 90, .15);
      --shadow2: 0 10px 30px rgba(8, 36, 90, .12);
      --radius: 20px;
      --ease: cubic-bezier(.2,.9,.2,1);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 18% 10%, #d8ebff 0%, transparent 60%),
        radial-gradient(900px 600px at 88% 20%, #c6f1ff 0%, transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* Subtle animated blobs */
    .blob{
      position:fixed;
      width:420px;height:420px;
      filter: blur(30px);
      opacity:.55;
      z-index:-1;
      border-radius:999px;
      animation: floaty 10s var(--ease) infinite;
      pointer-events:none;
    }
    .blob.one{ left:-140px; top:-140px; background: radial-gradient(circle at 30% 30%, #69b7ff, transparent 60%); }
    .blob.two{ right:-180px; top:80px; background: radial-gradient(circle at 30% 30%, #70e3ff, transparent 60%); animation-duration: 12s; }
    .blob.three{ left:30%; bottom:-220px; background: radial-gradient(circle at 30% 30%, #2f7cff, transparent 60%); animation-duration: 13s; opacity:.35;}
    @keyframes floaty{
      0%,100%{ transform: translate(0,0) scale(1); }
      50%{ transform: translate(18px, -22px) scale(1.03); }
    }

    .container{ width:min(1120px, 92vw); margin:0 auto; padding: 22px 0 60px; }

    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.62));
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    /* Buttons */
    .btn{
      border:none; outline:none; cursor:pointer;
      border-radius: 999px;
      padding: 12px 16px;
      font-weight: 650;
      transition: transform .22s var(--ease), box-shadow .22s var(--ease), background .22s var(--ease);
      display:inline-flex; align-items:center; gap:10px;
      user-select:none; text-decoration:none; white-space: nowrap;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn-primary{
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      color:#fff;
      box-shadow: 0 12px 30px rgba(11, 61, 145, .22);
    }
    .btn-primary:hover{ transform: translateY(-2px); box-shadow: 0 18px 45px rgba(11,61,145,.26); }
    .btn-ghost{
      background: rgba(255,255,255,.7);
      color: var(--brand);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow2);
    }
    .btn-ghost:hover{ transform: translateY(-2px); background: rgba(255,255,255,.85); }
    .btn-danger{
      background: rgba(229,57,53,.10);
      border:1px solid rgba(229,57,53,.20);
      color: var(--danger);
    }
    .btn-danger:hover{ transform: translateY(-2px); background: rgba(229,57,53,.14); }

    /* Inputs */
    .field{ display:flex; flex-direction:column; gap:8px; }
    label{ font-size: 12px; letter-spacing:.4px; color: var(--muted); font-weight:700; text-transform: uppercase;}
    input, select, textarea{
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      outline:none;
      background: rgba(255,255,255,.9);
      font-size: 14px;
      transition: box-shadow .2s var(--ease), border-color .2s var(--ease), transform .2s var(--ease);
    }
    input:focus, textarea:focus, select:focus{
      border-color: rgba(30,136,255,.35);
      box-shadow: 0 0 0 6px rgba(30,136,255,.12);
      transform: translateY(-1px);
    }

    /* Language pill */
    .lang{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(230,239,255,.9);
      background: rgba(255,255,255,.75);
      box-shadow: var(--shadow2);
    }
    .lang select{
      border:none; background: transparent;
      padding: 6px 8px;
      border-radius: 999px;
      font-weight: 750;
      color: var(--brand);
      cursor:pointer;
      outline:none;
    }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:20;
      background: rgba(245,249,255,.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(230,239,255,.7);
    }
    .topbar-inner{
      width:min(1120px, 92vw);
      margin: 0 auto;
      padding: 14px 0;
      display:flex; align-items:center; justify-content: space-between;
      gap: 14px;
    }

    .brand{ display:flex; align-items:center; gap:12px; min-width: 240px; }
    .logo{
      width:40px;height:40px;border-radius: 14px;
      background: linear-gradient(135deg, #0b3d91, #1e88ff 60%, #56c2ff);
      box-shadow: 0 12px 30px rgba(11,61,145,.25);
      position:relative; overflow:hidden;
    }
    .logo:before{
      content:""; position:absolute; width:70px;height:70px;
      left:-18px; top:-18px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.8), transparent 55%);
      transform: rotate(15deg);
      opacity:.65;
    }
    .brand h1{ margin:0; font-size: 16px; letter-spacing: .2px; }
    .brand p{ margin:0; font-size: 12px; color: var(--muted); margin-top: 2px; }

    /* Role pill */
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(230,239,255,.9);
      background: rgba(255,255,255,.75);
      color: var(--muted);
      font-size: 12px;
      font-weight: 900;
      box-shadow: var(--shadow2);
    }

    /* Hamburger */
    .hamburger{
      width:44px;height:44px;
      border-radius: 14px;
      border:1px solid rgba(230,239,255,.9);
      background: rgba(255,255,255,.75);
      box-shadow: var(--shadow2);
      cursor:pointer;
      display:grid; place-items:center;
      transition: transform .22s var(--ease), background .22s var(--ease);
    }
    .hamburger:hover{ transform: translateY(-2px); background: rgba(255,255,255,.9); }
    .ham-lines{ width:18px;height:12px; position:relative; }
    .ham-lines span{
      position:absolute; left:0; right:0;
      height:2px; border-radius:2px;
      background: linear-gradient(90deg, var(--brand), var(--brand2));
      transition: transform .25s var(--ease), top .25s var(--ease), opacity .2s var(--ease);
    }
    .ham-lines span:nth-child(1){ top:0; }
    .ham-lines span:nth-child(2){ top:5px; }
    .ham-lines span:nth-child(3){ top:10px; }
    .hamburger[data-open="true"] .ham-lines span:nth-child(1){ top:5px; transform: rotate(45deg); }
    .hamburger[data-open="true"] .ham-lines span:nth-child(2){ opacity:0; }
    .hamburger[data-open="true"] .ham-lines span:nth-child(3){ top:5px; transform: rotate(-45deg); }

    /* Sidebar */
    .overlay{
      position:fixed; inset:0;
      background: rgba(10,27,58,.34);
      opacity:0; pointer-events:none;
      transition: opacity .25s var(--ease);
      z-index: 30;
    }
    .overlay.show{ opacity:1; pointer-events:auto; }

    .sidebar{
      position:fixed; left:0; top:0; bottom:0;
      width: 310px;
      transform: translateX(-105%);
      transition: transform .34s var(--ease);
      z-index: 40;
      border-right: 1px solid rgba(230,239,255,.65);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.75));
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 20px 0 60px rgba(8,36,90,.14);
      padding: 16px;
    }
    .sidebar.open{ transform: translateX(0); }

    .sidebar-header{
      display:flex; align-items:center; justify-content: space-between;
      padding: 6px 4px 14px; gap: 12px;
    }
    .sidebar-header .mini{ display:flex; align-items:center; gap:10px; }
    .sidebar-header .mini strong{ font-size: 14px; }
    .sidebar-header .mini span{ display:block; font-size: 12px; color: var(--muted); margin-top:2px; }

    .nav{ display:flex; flex-direction: column; gap: 8px; margin-top: 10px; }
    .nav button{
      width:100%;
      text-align:left;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid transparent;
      background: transparent;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      transition: background .2s var(--ease), transform .2s var(--ease), border-color .2s var(--ease);
      font-weight: 800;
      color: var(--text);
    }
    .nav button:hover{
      background: rgba(30,136,255,.08);
      border-color: rgba(30,136,255,.12);
      transform: translateY(-1px);
    }
    .nav button.active{
      background: linear-gradient(135deg, rgba(11,61,145,.12), rgba(30,136,255,.10));
      border-color: rgba(30,136,255,.20);
    }
    .nav .meta{ font-size: 12px; color: var(--muted); font-weight: 700; }

    .sidebar-footer{
      position:absolute; left:16px; right:16px; bottom:16px;
      display:flex; gap: 10px; align-items:center; justify-content: space-between;
      padding-top: 14px;
      border-top: 1px solid rgba(230,239,255,.9);
    }

    /* App fade in */
    .app{ display:none; min-height:100vh; }
    .app.show{ display:block; animation: fadeIn .35s var(--ease) both; }
    @keyframes fadeIn{ from{ opacity:0; transform: translateY(10px); } to{ opacity:1; transform: translateY(0); } }

    /* Pages */
    .page{ display:none; animation: pageIn .35s var(--ease) both; }
    .page.show{ display:block; }
    @keyframes pageIn{ from{ opacity:0; transform: translateY(10px); } to{ opacity:1; transform: translateY(0); } }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
      margin-top: 20px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .brand{ min-width: unset; }
      .sidebar{ width: 86vw; max-width: 340px; }
    }

    .panel{ padding: 18px; }
    .panel h2{ margin: 4px 0 6px; font-size: 18px; }
    .panel p{ margin: 0; color: var(--muted); line-height: 1.5; }

    .hero{
      padding: 22px;
      position:relative;
      overflow:hidden;
    }
    .hero:after{
      content:"";
      position:absolute;
      inset:-60px -90px auto auto;
      width:260px;height:260px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(86,194,255,.55), transparent 62%);
      filter: blur(8px);
      opacity:.8;
      transform: rotate(12deg);
    }
    .hero h2{ margin:0; font-size: 22px; letter-spacing: .2px; }
    .hero .sub{ margin-top: 8px; color: var(--muted); line-height: 1.55; max-width: 60ch; }

    .chiprow{ display:flex; flex-wrap:wrap; gap:10px; margin-top: 14px; }
    .chip{
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(30,136,255,.10);
      border: 1px solid rgba(30,136,255,.12);
      color: var(--brand);
      font-weight: 800;
      font-size: 12px;
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-top: 16px;
    }
    @media (max-width: 980px){ .cards{ grid-template-columns: 1fr; } }
    .card{
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(230,239,255,.9);
      background: rgba(255,255,255,.7);
      box-shadow: var(--shadow2);
      transition: transform .22s var(--ease), box-shadow .22s var(--ease), background .22s var(--ease);
      cursor:pointer;
      position:relative;
      overflow:hidden;
    }
    .card:hover{
      transform: translateY(-3px);
      box-shadow: 0 18px 50px rgba(8,36,90,.14);
      background: rgba(255,255,255,.85);
    }
    .card h3{ margin: 2px 0 8px; font-size: 15px; }
    .card p{ margin:0; color: var(--muted); font-size: 13px; line-height: 1.5; }
    .card .icon{
      width:42px;height:42px;border-radius: 16px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(11,61,145,.14), rgba(30,136,255,.10));
      border: 1px solid rgba(30,136,255,.14);
      margin-bottom: 12px;
      color: var(--brand);
      font-weight: 900;
    }

    .widget{ padding: 18px; }
    .widget h3{ margin:0 0 10px; font-size: 15px; }
    .list{ display:flex; flex-direction:column; gap:10px; }
    .item{
      display:flex;
      align-items:flex-start;
      gap:12px;
      padding: 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(230,239,255,.9);
      transition: transform .2s var(--ease);
    }
    .item:hover{ transform: translateY(-2px); }
    .dot{
      width:10px;height:10px;border-radius: 999px;
      margin-top: 4px;
      background: linear-gradient(135deg, var(--brand2), var(--brand3));
      box-shadow: 0 6px 16px rgba(30,136,255,.25);
      flex: 0 0 auto;
    }
    .item .t{ font-weight: 900; font-size: 13px; margin:0; }
    .item .d{ margin:3px 0 0; color: var(--muted); font-size: 12px; line-height: 1.45; }

    /* Login */
    .login{
      min-height: 100vh;
      display:grid;
      place-items:center;
      padding: 28px 0;
    }
    .login-card{
      width: min(980px, 92vw);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      overflow:hidden;
    }
    @media (max-width: 980px){
      .login-card{ grid-template-columns: 1fr; }
      .login-hero{ display:none; }
    }
    .login-hero{
      padding: 28px;
      position:relative;
      background: linear-gradient(135deg, rgba(11,61,145,.92), rgba(30,136,255,.88));
      color:#fff;
    }
    .login-hero h2{ margin:0; font-size: 26px; letter-spacing:.2px; }
    .login-hero p{ margin: 10px 0 0; opacity:.9; line-height: 1.55; }
    .login-hero .bubbles{
      position:absolute; inset:auto -80px -120px auto;
      width: 380px; height:380px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.30), transparent 60%);
      filter: blur(8px);
      transform: rotate(10deg);
      opacity:.9;
    }
    .login-hero .bubbles2{
      position:absolute; inset:-120px auto auto -100px;
      width: 320px; height:320px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(86,194,255,.55), transparent 62%);
      filter: blur(10px);
      opacity:.8;
    }

    .login-form{
      padding: 26px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.70));
    }
    .login-title{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 6px;
    }
    .login-title .left{ display:flex; align-items:center; gap: 12px; }
    .login-title h1{ margin:0; font-size: 18px; letter-spacing:.2px; }
    .login-title small{ display:block; color: var(--muted); margin-top: 2px; font-weight: 750; }

    .hint{ font-size: 12px; color: var(--muted); line-height: 1.5; margin-top: 6px; }
    .footnote{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 10px;
      border:1px solid rgba(230,239,255,.95);
      background: rgba(255,255,255,.8);
      color: var(--muted);
    }

    /* Toast */
    .toast-wrap{
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 100;
      display:flex;
      flex-direction:column;
      gap: 10px;
      pointer-events:none;
    }
    .toast{
      pointer-events:auto;
      width:min(380px, 92vw);
      padding: 12px 14px;
      border-radius: 16px;
      border:1px solid rgba(230,239,255,.9);
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow2);
      display:flex;
      align-items:flex-start;
      gap: 10px;
      animation: toastIn .25s var(--ease) both;
    }
    @keyframes toastIn{ from{ opacity:0; transform: translateY(10px); } to{ opacity:1; transform: translateY(0); } }
    .toast .badge{
      width:10px;height:10px;border-radius: 999px; margin-top:4px;
      background: var(--brand2);
      box-shadow: 0 6px 16px rgba(30,136,255,.25);
    }
    .toast.success .badge{ background: var(--success); box-shadow: 0 6px 16px rgba(46,125,50,.22); }
    .toast.danger .badge{ background: var(--danger); box-shadow: 0 6px 16px rgba(229,57,53,.22); }
    .toast p{ margin:0; font-size: 13px; line-height: 1.45; color: var(--text); }
    .toast p span{ display:block; margin-top:2px; color: var(--muted); font-size: 12px; line-height: 1.35; }

    /* Journal */
    .badge-small{
      font-size: 11px;
      font-weight: 900;
      padding: 5px 9px;
      border-radius: 999px;
      background: rgba(30,136,255,.10);
      border:1px solid rgba(30,136,255,.12);
      color: var(--brand);
      white-space: nowrap;
    }
    .file-actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .month-grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 14px;
    }
    @media (max-width: 980px){ .month-grid{ grid-template-columns: repeat(2, 1fr); } }
    .month-btn{
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid rgba(230,239,255,.9);
      background: rgba(255,255,255,.75);
      box-shadow: var(--shadow2);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      transition: transform .2s var(--ease), background .2s var(--ease);
      font-weight: 900;
      color: var(--text);
    }
    .month-btn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.9); }
    .month-btn.active{
      background: linear-gradient(135deg, rgba(11,61,145,.12), rgba(30,136,255,.10));
      border-color: rgba(30,136,255,.22);
    }

    /* ===== Expatria√ß√£o Profiles (social layout) ===== */
    .exp-layout{
      display:grid;
      grid-template-columns: 340px 1fr;
      gap: 18px;
      margin-top: 20px;
    }
    @media (max-width: 980px){
      .exp-layout{ grid-template-columns: 1fr; }
    }

    .exp-side{
      padding: 16px;
      position: sticky;
      top: 84px;
      height: calc(100vh - 110px);
      overflow:auto;
      transition: width .28s var(--ease), transform .28s var(--ease);
    }
    .exp-side.collapsed{ width: 96px; }
    .exp-side.collapsed .exp-block,
    .exp-side.collapsed .muted,
    .exp-side.collapsed .field,
    .exp-side.collapsed .exp-mini-form,
    .exp-side.collapsed .exp-block-title strong,
    .exp-side.collapsed .side-label{
      display:none !important;
    }
    .exp-side-head{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 10px;
    }
    .muted{ color: var(--muted); font-size: 13px; line-height: 1.45; margin: 4px 0 0; }

    .exp-block{
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid rgba(230,239,255,.9);
    }
    .exp-block-title{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }

    .exp-list{ display:flex; flex-direction:column; gap:10px; }
    .exp-entry{
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 10px;
      border-radius: 16px;
      border: 1px solid rgba(230,239,255,.9);
      background: rgba(255,255,255,.7);
      cursor:pointer;
      transition: transform .2s var(--ease), background .2s var(--ease);
    }
    .exp-entry:hover{ transform: translateY(-2px); background: rgba(255,255,255,.9); }
    .exp-entry.active{
      background: linear-gradient(135deg, rgba(11,61,145,.12), rgba(30,136,255,.10));
      border-color: rgba(30,136,255,.22);
    }
    .exp-entry .mini-avatar{
      width:34px; height:34px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(11,61,145,.12), rgba(30,136,255,.12));
      border: 1px solid rgba(30,136,255,.14);
      display:grid; place-items:center;
      overflow:hidden;
      flex: 0 0 auto;
      font-weight:900;
      color: var(--brand);
    }
    .exp-entry .mini-avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    .exp-entry .txt{ min-width:0; }
    .exp-entry .txt b{ display:block; font-size: 13px; }
    .exp-entry .txt small{
      display:block;
      color: var(--muted);
      font-size: 12px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 190px;
    }

    .exp-mini-form{ margin-top: 10px; display:flex; flex-direction:column; gap:10px; }
    .row-2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    @media (max-width: 980px){ .row-2{ grid-template-columns: 1fr; } }

    .exp-main{ min-width:0; }
    .exp-profile{ overflow:hidden; }
    .exp-cover{
      height: 120px;
      background: linear-gradient(135deg, rgba(11,61,145,.92), rgba(30,136,255,.88));
      position:relative;
    }
    .exp-cover-glow{
      position:absolute;
      right:-60px; top:-60px;
      width:220px; height:220px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(86,194,255,.7), transparent 60%);
      filter: blur(8px);
      opacity:.9;
    }

    .exp-header{
      display:flex;
      gap: 16px;
      padding: 0 18px 18px;
      margin-top: -34px;
      align-items:flex-end;
    }
    @media (max-width: 980px){
      .exp-header{ flex-direction: column; align-items:flex-start; margin-top:-44px; }
    }
    .exp-avatar-wrap{
      width: 92px; height: 92px;
      border-radius: 26px;
      border: 4px solid rgba(255,255,255,.85);
      background: rgba(255,255,255,.75);
      overflow:hidden;
      box-shadow: var(--shadow2);
      position:relative;
    }
    .exp-avatar{ width:100%; height:100%; object-fit:cover; display:none; }
    .exp-avatar-fallback{
      width:100%; height:100%;
      display:grid; place-items:center;
      font-size: 28px;
      color: var(--brand);
      font-weight: 900;
    }
    .exp-header-info{ flex:1; min-width:0; }
    .exp-header-info h2{ margin:0; font-size: 20px; }
    .exp-header-info p{ margin: 6px 0 0; }
    .exp-header-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }

    .exp-tabs{
      display:flex;
      gap: 10px;
      padding: 0 18px 18px;
    }
    .exp-tab{
      border:none;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(230,239,255,.9);
      font-weight: 900;
      transition: transform .2s var(--ease), background .2s var(--ease);
    }
    .exp-tab:hover{ transform: translateY(-2px); background: rgba(255,255,255,.92); }
    .exp-tab.active{
      background: linear-gradient(135deg, rgba(11,61,145,.12), rgba(30,136,255,.10));
      border-color: rgba(30,136,255,.22);
      color: var(--brand);
    }

    .exp-body{ padding: 0 18px 18px; }
    .exp-grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 16px;
    }
    @media (max-width: 980px){ .exp-grid{ grid-template-columns: 1fr; } }

    .exp-box{ padding: 16px; border-radius: var(--radius); }
    .exp-box h3{ margin: 0 0 10px; font-size: 15px; }

    .exp-form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 980px){ .exp-form{ grid-template-columns: 1fr; } }

    .exp-save-row{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 14px;
    }
  </style>
</head>

<body>
  <div class="blob one"></div>
  <div class="blob two"></div>
  <div class="blob three"></div>

  <div class="toast-wrap" id="toastWrap" aria-live="polite" aria-atomic="true"></div>

  <!-- LOGIN VIEW -->
  <main class="login" id="loginView">
    <section class="login-card glass" role="region" aria-label="Tela de login">
      <div class="login-hero">
        <div style="display:flex; align-items:center; gap:12px;">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h2 data-i18n="portalName">Hyundai Portal</h2>
            <p data-i18n="loginHeroText" style="margin:6px 0 0; max-width: 48ch;">
              Um portal moderno com acesso r√°pido a funcionalidades internas, documentos e comunica√ß√£o.
            </p>
          </div>
        </div>
        <div class="chiprow" aria-hidden="true">
          <span class="chip" data-i18n="chipModern">Design Moderno</span>
          <span class="chip" data-i18n="chipSmooth">Anima√ß√µes Fluidas</span>
          <span class="chip" data-i18n="chipFast">Acesso R√°pido</span>
        </div>
        <p style="margin-top:18px; font-size: 12px; opacity:.88;" data-i18n="loginHeroNote">
          Demo local (front-end). Para seguran√ßa real, use autentica√ß√£o no servidor.
        </p>
        <div class="bubbles" aria-hidden="true"></div>
        <div class="bubbles2" aria-hidden="true"></div>
      </div>

      <form class="login-form" id="loginForm" autocomplete="on">
        <div class="login-title">
          <div class="left">
            <div class="logo" aria-hidden="true"></div>
            <div>
              <h1 data-i18n="signInTitle">Entrar</h1>
              <small data-i18n="signInSubtitle">Use suas credenciais para acessar</small>
            </div>
          </div>

          <div class="lang" title="Language">
            <span aria-hidden="true">üåê</span>
            <select id="langSelectLogin" aria-label="Selecionar idioma">
              <option value="pt">PT</option>
              <option value="en">EN</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label for="email" data-i18n="emailLabel">E-mail</label>
          <input id="email" name="email" type="email" required
                 data-i18n-placeholder="emailPlaceholder"
                 placeholder="ex: nome@empresa.com" />
        </div>

        <div class="field">
          <label for="pass" data-i18n="passwordLabel">Senha</label>
          <input id="pass" name="pass" type="password" required
                 data-i18n-placeholder="passwordPlaceholder"
                 placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          <div class="hint">
            <span data-i18n="demoHintTitle">Contas demo</span>:
            <br/>
            <b>Admin</b>: <span class="kbd">admin@hyundai.com</span> + <span class="kbd">admin123</span>
            <br/>
            <b>User</b>: <span class="kbd">user@hyundai.com</span> + <span class="kbd">portal123</span>
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:6px;">
          <button class="btn btn-primary" type="submit" style="flex:1;">
            <span aria-hidden="true">üîê</span> <span data-i18n="accessBtn">Acessar</span>
          </button>
          <button class="btn btn-ghost" type="button" id="fillDemoBtn">
            <span aria-hidden="true">‚ú®</span> <span data-i18n="fillDemoBtn">Preencher demo</span>
          </button>
        </div>

        <div class="footnote">
          <span>¬© <span id="year"></span> <span data-i18n="portalName">Hyundai Portal</span></span>
          <span class="kbd" data-i18n="kbdTip">Dica: Alt + M abre o menu</span>
        </div>
      </form>
    </section>
  </main>

  <!-- APP VIEW -->
  <div class="app" id="appView" aria-hidden="true">
    <header class="topbar">
      <div class="topbar-inner">
        <div style="display:flex; align-items:center; gap:12px;">
          <button class="hamburger" id="hamburger" aria-label="Abrir menu" aria-controls="sidebar" aria-expanded="false" data-open="false">
            <div class="ham-lines" aria-hidden="true"><span></span><span></span><span></span></div>
          </button>

          <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
              <h1 data-i18n="portalName">Hyundai Portal</h1>
              <p id="welcomeText" data-i18n="welcomeDefault">Bem-vindo(a)!</p>
            </div>
          </div>

          <span class="pill" id="rolePill" style="display:none;"></span>
        </div>

        <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
          <div class="lang" title="Language">
            <span aria-hidden="true">üåê</span>
            <select id="langSelectApp" aria-label="Selecionar idioma">
              <option value="pt">PT</option>
              <option value="en">EN</option>
            </select>
          </div>

          <button class="btn btn-ghost" id="goHomeBtn" type="button">
            <span aria-hidden="true">üè†</span> <span data-i18n="homeBtn">In√≠cio</span>
          </button>

          <button class="btn btn-danger" id="logoutBtn" type="button">
            <span aria-hidden="true">‚Ü©</span> <span data-i18n="logoutBtn">Sair</span>
          </button>
        </div>
      </div>
    </header>

    <div class="overlay" id="overlay" tabindex="-1" aria-hidden="true"></div>

    <aside class="sidebar" id="sidebar" aria-label="Menu lateral">
      <div class="sidebar-header">
        <div class="mini">
          <div class="logo" style="width:34px; height:34px; border-radius: 12px;" aria-hidden="true"></div>
          <div>
            <strong data-i18n="menuTitle">Menu</strong>
            <span id="userMeta" data-i18n="sessionActive">Sess√£o ativa</span>
          </div>
        </div>
        <button class="btn btn-ghost" type="button" id="closeSidebarBtn" style="padding:10px 12px;">‚úï</button>
      </div>

      <nav class="nav" id="nav">
        <button type="button" data-page="home" class="active">
          <span data-i18n="navHome">üè† Home</span> <span class="meta" data-i18n="navHomeMeta">Vis√£o geral</span>
        </button>
        <button type="button" data-page="journal">
          <span data-i18n="navJournal">üóûÔ∏è Jornal</span> <span class="meta" data-i18n="navJournalMeta">Arquivos mensais</span>
        </button>
        <button type="button" data-page="expatriacao" id="navExpatBtn">
          <span data-i18n="navExpat">‚úàÔ∏è Expatria√ß√£o</span> <span class="meta" data-i18n="navExpatMeta">Admin</span>
        </button>
        <button type="button" data-page="documentos">
          <span data-i18n="navDocs">üìÅ Documentos</span> <span class="meta" data-i18n="navDocsMeta">Arquivos</span>
        </button>
        <button type="button" data-page="suporte">
          <span data-i18n="navSupport">üõü Suporte</span> <span class="meta" data-i18n="navSupportMeta">Ajuda</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <span class="meta" data-i18n="shortcuts">Atalhos</span>
        <span class="kbd" data-i18n="escCloses">Esc fecha</span>
      </div>
    </aside>

    <main class="container">
      <!-- HOME -->
      <section class="page show" id="page-home" aria-label="Home">
        <div class="hero glass">
          <h2 data-i18n="homeHeroTitle">Portal interno com acesso r√°pido</h2>
          <p class="sub" data-i18n="homeHeroSub">
            Acesse funcionalidades essenciais, atualiza√ß√µes e documentos com uma experi√™ncia moderna, fluida e responsiva.
          </p>
          <div class="chiprow" style="margin-top:16px;">
            <span class="chip" data-i18n="chipBlueWhite">Azul & Branco</span>
            <span class="chip" data-i18n="chipSidebar">Menu lateral</span>
            <span class="chip" data-i18n="chipTransitions">Transi√ß√µes suaves</span>
            <span class="chip" data-i18n="chipSPA">SPA (telas internas)</span>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;">
            <button class="btn btn-primary" type="button" data-goto="journal">
              <span aria-hidden="true">üóûÔ∏è</span> <span data-i18n="goJournal">Abrir Jornal</span>
            </button>
            <button class="btn btn-ghost" type="button" data-goto="documentos">
              <span aria-hidden="true">üìÅ</span> <span data-i18n="goDocs">Ver Documentos</span>
            </button>
          </div>
        </div>

        <div class="grid">
          <section class="panel glass">
            <h2 data-i18n="quickFeaturesTitle">Funcionalidades r√°pidas</h2>
            <p data-i18n="quickFeaturesSub">Escolha uma √°rea para abrir a tela correspondente.</p>

            <div class="cards" role="list">
              <div class="card" role="listitem" data-goto="journal" tabindex="0">
                <div class="icon" aria-hidden="true">JR</div>
                <h3 data-i18n="cardJRTitle">Jornal</h3>
                <p data-i18n="cardJRDesc">Selecione o m√™s e abra arquivos do jornal interno.</p>
              </div>

              <div class="card" role="listitem" data-goto="expatriacao" tabindex="0">
                <div class="icon" aria-hidden="true">EX</div>
                <h3 data-i18n="cardEXTitle">Expatria√ß√£o</h3>
                <p data-i18n="cardEXDesc">M√≥dulo de perfis e familiares (somente admin).</p>
              </div>

              <div class="card" role="listitem" data-goto="documentos" tabindex="0">
                <div class="icon" aria-hidden="true">DOC</div>
                <h3 data-i18n="cardDOCTitle">Documentos</h3>
                <p data-i18n="cardDOCDesc">Cat√°logo de arquivos, pol√≠ticas, formul√°rios e downloads essenciais.</p>
              </div>
            </div>
          </section>

          <aside class="widget glass">
            <h3 data-i18n="updatesTitle">Atualiza√ß√µes r√°pidas</h3>
            <div class="list">
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="update1Title">Bem-vindo ao Hyundai Portal</p>
                  <p class="d" data-i18n="update1Desc">Use o menu hamb√∫rguer para navegar entre as telas.</p>
                </div>
              </div>
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="updateJRTitle">Jornal mensal</p>
                  <p class="d" data-i18n="updateJRDesc">Escolha de janeiro a dezembro para abrir os arquivos.</p>
                </div>
              </div>
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="updateLangTitle">Idiomas</p>
                  <p class="d" data-i18n="updateLangDesc">Voc√™ pode alternar entre Portugu√™s e Ingl√™s no topo.</p>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <!-- JOURNAL -->
      <section class="page" id="page-journal" aria-label="Jornal">
        <div class="panel glass">
          <h2 data-i18n="jrTitle">üóûÔ∏è Jornal (Janeiro a Dezembro)</h2>
          <p data-i18n="jrSub">
            Selecione um m√™s para ver os arquivos dispon√≠veis. Administradores podem adicionar/remover arquivos.
          </p>

          <div class="file-actions" style="margin-top:12px;">
            <span class="pill" id="jrStorageHint"></span>

            <button class="btn btn-ghost" type="button" id="jrExportBtn">
              <span aria-hidden="true">‚¨á</span> <span data-i18n="jrExport">Exportar lista</span>
            </button>
            <button class="btn btn-ghost" type="button" id="jrImportBtn">
              <span aria-hidden="true">‚¨Ü</span> <span data-i18n="jrImport">Importar lista</span>
            </button>
            <input type="file" id="jrImportFile" accept="application/json" style="display:none;" />
          </div>
        </div>

        <div class="grid">
          <section class="panel glass">
            <h2 data-i18n="jrPickMonth">Escolha um m√™s</h2>
            <div class="month-grid" id="jrMonthGrid"></div>

            <div style="margin-top:16px;">
              <h2 id="jrMonthTitle">‚Äî</h2>
              <p id="jrMonthSubtitle" style="margin:0; color:var(--muted);"></p>

              <div id="jrFileList" class="list" style="margin-top:12px;"></div>
            </div>
          </section>

          <aside class="widget glass">
            <h3 data-i18n="jrAdminTitle">Administra√ß√£o</h3>
            <p id="jrAdminNote" style="margin:0 0 10px; color:var(--muted); font-size:13px;"></p>

            <div id="jrAdminPanel" style="display:none;">
              <form id="jrAddForm" style="display:flex; flex-direction:column; gap:12px; margin-top:12px;">
                <div class="field">
                  <label for="jrMonthSelect" data-i18n="jrMonthLabel">M√™s</label>
                  <select id="jrMonthSelect"></select>
                </div>

                <div class="field">
                  <label for="jrTitleInput" data-i18n="jrFileTitleLabel">T√≠tulo do arquivo</label>
                  <input id="jrTitleInput" type="text" required data-i18n-placeholder="jrFileTitlePh" placeholder="Ex: Jornal - Janeiro 2026" />
                </div>

                <div class="field">
                  <label for="jrTypeSelect" data-i18n="jrTypeLabel">Tipo</label>
                  <select id="jrTypeSelect">
                    <option value="url" data-i18n="jrTypeUrl">Link (URL)</option>
                    <option value="upload" data-i18n="jrTypeUpload">Upload (salvo no navegador)</option>
                  </select>
                </div>

                <div class="field" id="jrUrlWrap">
                  <label for="jrUrlInput" data-i18n="jrUrlLabel">URL</label>
                  <input id="jrUrlInput" type="url" data-i18n-placeholder="jrUrlPh" placeholder="https://..." />
                </div>

                <div class="field" id="jrUploadWrap" style="display:none;">
                  <label for="jrFileInput" data-i18n="jrUploadLabel">Arquivo</label>
                  <input id="jrFileInput" type="file" />
                  <p class="hint" data-i18n="jrUploadHint">
                    Upload √© uma demonstra√ß√£o: o arquivo fica salvo no navegador (localStorage) e pode ter limites de tamanho.
                  </p>
                </div>

                <button class="btn btn-primary" type="submit">
                  <span aria-hidden="true">‚ûï</span> <span data-i18n="jrAddBtn">Adicionar</span>
                </button>

                <button class="btn btn-danger" type="button" id="jrClearAllBtn">
                  <span aria-hidden="true">üóë</span> <span data-i18n="jrClearAll">Limpar todos (admin)</span>
                </button>
              </form>
            </div>

            <div class="list" style="margin-top:12px;">
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="jrTip1T">Dica</p>
                  <p class="d" data-i18n="jrTip1D">Para ‚Äúhospedar‚Äù de verdade, use links do SharePoint/Drive e cadastre aqui.</p>
                </div>
              </div>
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="jrTip2T">Permiss√µes</p>
                  <p class="d" data-i18n="jrTip2D">Somente admin v√™ o painel de adicionar/remover.</p>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <!-- EXPAT (ADMIN ONLY) -->
      <section class="page" id="page-expatriacao" aria-label="Expatria√ß√£o">
        <div class="panel glass">
          <h2 data-i18n="exNewTitle">‚úàÔ∏è Expatria√ß√£o ‚Äî Perfis</h2>
          <p data-i18n="exNewSub">
            M√≥dulo de perfis (admin). Gerencie dados do usu√°rio e familiares com layout moderno.
          </p>
        </div>

        <div class="exp-layout">
          <!-- Left expandable panel -->
          <aside class="exp-side glass" id="expSide">
            <div class="exp-side-head">
              <div>
                <h3 data-i18n="exDirectoryTitle">Diret√≥rio</h3>
                <p class="muted" data-i18n="exDirectorySub">Usu√°rios e familiares</p>
              </div>
              <button class="btn btn-ghost" type="button" id="expToggleSideBtn" style="padding:10px 12px;">
                <span aria-hidden="true">‚´∂</span>
                <span class="side-label" data-i18n="exCollapse">Recolher</span>
              </button>
            </div>

            <!-- Users -->
            <div class="exp-block">
              <div class="exp-block-title">
                <strong data-i18n="exUsersTitle">Usu√°rios</strong>
                <span class="badge-small" id="expUsersCount">0</span>
              </div>

              <div class="field" style="margin-top:10px;">
                <label for="expUserSearch" data-i18n="exSearchLabel">Buscar</label>
                <input id="expUserSearch" type="text" data-i18n-placeholder="exSearchPh" placeholder="Nome ou e-mail..." />
              </div>

              <div class="exp-list" id="expUserList" style="margin-top:10px;"></div>

              <form id="expAddUserForm" class="exp-mini-form">
                <div class="row-2">
                  <input id="expNewUserName" type="text" required data-i18n-placeholder="exUserNamePh" placeholder="Nome" />
                  <input id="expNewUserEmail" type="email" required data-i18n-placeholder="exUserEmailPh" placeholder="email@empresa.com" />
                </div>
                <button class="btn btn-primary" type="submit" style="width:100%;">
                  <span aria-hidden="true">‚ûï</span> <span data-i18n="exAddUser">Adicionar usu√°rio</span>
                </button>
              </form>
            </div>

            <!-- Family -->
            <div class="exp-block" style="margin-top:12px;">
              <div class="exp-block-title">
                <strong data-i18n="exFamilyTitle">Fam√≠lia</strong>
                <span class="badge-small" id="expFamilyCount">0</span>
              </div>

              <div class="exp-list" id="expFamilyList" style="margin-top:10px;"></div>

              <form id="expAddFamilyForm" class="exp-mini-form">
                <div class="row-2">
                  <input id="expNewFamilyName" type="text" required data-i18n-placeholder="exFamilyNamePh" placeholder="Nome" />
                  <input id="expNewFamilyRelation" type="text" required data-i18n-placeholder="exFamilyRelationPh" placeholder="Parentesco" />
                </div>
                <button class="btn btn-ghost" type="submit" style="width:100%;">
                  <span aria-hidden="true">üë™</span> <span data-i18n="exAddFamily">Adicionar familiar</span>
                </button>
                <p class="hint" data-i18n="exFamilyHint">Selecione um usu√°rio antes de adicionar familiares.</p>
              </form>
            </div>
          </aside>

          <!-- Main profile area -->
          <section class="exp-main">
            <div class="exp-profile glass" id="expProfileCard">
              <div class="exp-cover">
                <div class="exp-cover-glow"></div>
              </div>

              <div class="exp-header">
                <div class="exp-avatar-wrap">
                  <img id="expAvatarImg" class="exp-avatar" alt="Avatar" />
                  <div class="exp-avatar-fallback" id="expAvatarFallback">üë§</div>
                  <input id="expPhotoInput" type="file" accept="image/*" hidden />
                </div>

                <div class="exp-header-info">
                  <h2 id="expDisplayName">‚Äî</h2>
                  <p class="muted" id="expDisplayMeta">‚Äî</p>
                  <div class="exp-header-actions">
                    <button class="btn btn-ghost" type="button" id="expAddPhotoBtn">
                      <span aria-hidden="true">üì∑</span> <span data-i18n="exAddPhoto">Adicionar foto</span>
                    </button>
                    <button class="btn btn-danger" type="button" id="expRemovePhotoBtn">
                      <span aria-hidden="true">üóë</span> <span data-i18n="exRemovePhoto">Remover foto</span>
                    </button>
                    <button class="btn btn-danger" type="button" id="expDeleteProfileBtn">
                      <span aria-hidden="true">üßπ</span> <span data-i18n="exDeleteProfile">Excluir perfil</span>
                    </button>
                  </div>
                </div>
              </div>

              <div class="exp-tabs">
                <button class="exp-tab active" type="button" data-exp-tab="dados">
                  <span aria-hidden="true">ü™™</span> <span data-i18n="exTabData">Dados</span>
                </button>
                <button class="exp-tab" type="button" data-exp-tab="atividade">
                  <span aria-hidden="true">ü´ß</span> <span data-i18n="exTabFeed">Atividade</span>
                </button>
              </div>

              <!-- DATA TAB -->
              <div class="exp-body" id="expTab-dados">
                <div class="exp-grid">
                  <div class="glass exp-box">
                    <h3 data-i18n="exDocTitle">Documentos / Dados</h3>

                    <div class="exp-form">
                      <div class="field">
                        <label data-i18n="exCpf">CPF</label>
                        <input id="expCpf" type="text" placeholder="000.000.000-00" />
                      </div>
                      <div class="field">
                        <label data-i18n="exRne">RNE</label>
                        <input id="expRne" type="text" placeholder="RNE..." />
                      </div>
                      <div class="field">
                        <label data-i18n="exCnh">CNH</label>
                        <input id="expCnh" type="text" placeholder="CNH..." />
                      </div>
                      <div class="field">
                        <label data-i18n="exHouse">Casa</label>
                        <input id="expHouse" type="text" placeholder="Endere√ßo / resid√™ncia" />
                      </div>
                      <div class="field">
                        <label data-i18n="exPassport">Passaporte</label>
                        <input id="expPassport" type="text" placeholder="Passaporte..." />
                      </div>
                    </div>

                    <div class="exp-save-row">
                      <button class="btn btn-primary" type="button" id="expSaveBtnNew">
                        <span aria-hidden="true">üíæ</span> <span data-i18n="exSaveNew">Salvar altera√ß√µes</span>
                      </button>
                      <span class="pill" id="expLastUpdated">‚Äî</span>
                    </div>

                    <p class="hint" data-i18n="exPrivacy">
                      Demo: dados s√£o salvos no navegador (localStorage). Em produ√ß√£o, use backend seguro.
                    </p>
                  </div>

                  <aside class="glass exp-box">
                    <h3 data-i18n="exSelected">Selecionado</h3>
                    <div class="list" id="expSelectedInfo"></div>
                  </aside>
                </div>
              </div>

              <!-- FEED TAB -->
              <div class="exp-body" id="expTab-atividade" style="display:none;">
                <div class="glass exp-box">
                  <h3 data-i18n="exFeedTitle">Atividade</h3>
                  <div class="list" id="expFeed"></div>
                </div>
              </div>
            </div>

            <div class="panel glass" style="margin-top:18px;">
              <h2 data-i18n="exTipsTitle">Boas pr√°ticas</h2>
              <p class="muted" data-i18n="exTipsSub">
                Para ‚Äúacesso real‚Äù, salve arquivos/documentos em SharePoint/Drive e referencie links aqui.
              </p>
            </div>
          </section>
        </div>
      </section>

      <!-- DOCUMENTOS -->
      <section class="page" id="page-documentos" aria-label="Documentos">
        <div class="panel glass">
          <h2 data-i18n="docsTitle">üìÅ Documentos</h2>
          <p data-i18n="docsSub">Cat√°logo de documentos (exemplo). Voc√™ pode trocar por links reais ou integra√ß√µes.</p>
        </div>

        <div class="grid">
          <section class="panel glass">
            <h2 data-i18n="docsSearchTitle">Buscar</h2>
            <div class="field" style="margin-top:12px;">
              <label for="docSearch" data-i18n="docsSearchLabel">Pesquisar documento</label>
              <input id="docSearch" type="text" data-i18n-placeholder="docsSearchPh" placeholder="Ex: Pol√≠tica, Formul√°rio, Manual..." />
            </div>
            <div class="cards" id="docCards" style="margin-top:14px;"></div>
          </section>

          <aside class="widget glass">
            <h3 data-i18n="docsShortcuts">Atalhos</h3>
            <div class="list">
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="docsS1T">Pol√≠ticas internas</p>
                  <p class="d" data-i18n="docsS1D">Acesse documentos institucionais e regras atualizadas.</p>
                </div>
              </div>
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="docsS2T">Formul√°rios</p>
                  <p class="d" data-i18n="docsS2D">Modelos prontos para solicita√ß√µes e processos.</p>
                </div>
              </div>
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="docsS3T">Manuais</p>
                  <p class="d" data-i18n="docsS3D">Guias de uso e instru√ß√µes operacionais.</p>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <!-- SUPORTE -->
      <section class="page" id="page-suporte" aria-label="Suporte">
        <div class="panel glass">
          <h2 data-i18n="supTitle">üõü Suporte</h2>
          <p data-i18n="supSub">Abra uma solicita√ß√£o (demo) ou registre uma d√∫vida. Ideal para integrar com Service Desk.</p>
        </div>

        <div class="grid">
          <section class="panel glass">
            <h2 data-i18n="supNew">Nova solicita√ß√£o</h2>
            <form id="supportForm" style="margin-top:12px; display:flex; flex-direction:column; gap:12px;">
              <div class="field">
                <label for="supTitleInput" data-i18n="supTitleLabel">T√≠tulo</label>
                <input id="supTitleInput" type="text" required data-i18n-placeholder="supTitlePh" placeholder="Ex: Acesso ao sistema" />
              </div>
              <div class="field">
                <label for="supDesc" data-i18n="supDescLabel">Descri√ß√£o</label>
                <textarea id="supDesc" rows="5" required data-i18n-placeholder="supDescPh" placeholder="Descreva o problema..."></textarea>
              </div>
              <button class="btn btn-primary" type="submit">
                <span aria-hidden="true">üì®</span> <span data-i18n="supSend">Enviar (demo)</span>
              </button>
              <p class="hint" data-i18n="supHint">Para produ√ß√£o, enviar para API/servidor e gerar ticket.</p>
            </form>
          </section>

          <aside class="widget glass">
            <h3 data-i18n="supBest">Boas pr√°ticas</h3>
            <div class="list">
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="supB1T">Inclua prints e contexto</p>
                  <p class="d" data-i18n="supB1D">Ajuda o time a reproduzir e resolver mais r√°pido.</p>
                </div>
              </div>
              <div class="item">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <p class="t" data-i18n="supB2T">Informe seu usu√°rio e setor</p>
                  <p class="d" data-i18n="supB2D">Facilita a valida√ß√£o de permiss√µes e acessos.</p>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <div style="height: 40px;"></div>
    </main>
  </div>

  <script>
    /* ===============================
       Utils
       =============================== */
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const year = $("#year");
    year.textContent = new Date().getFullYear();

    function escapeHtml(str){
      return (str ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function readFileAsDataURL(file){
      return new Promise((resolve, reject) => {
        const fr = new FileReader();
        fr.onload = () => resolve(fr.result);
        fr.onerror = reject;
        fr.readAsDataURL(file);
      });
    }

    /* ===============================
       Toasts
       =============================== */
    const toastWrap = $("#toastWrap");
    function toast(message, detail="", type="info", ttl=2600){
      const el = document.createElement("div");
      el.className = `toast ${type}`;
      el.innerHTML = `
        <div class="badge" aria-hidden="true"></div>
        <p><b>${escapeHtml(message)}</b>${detail ? `<span>${escapeHtml(detail)}</span>` : ""}</p>
      `;
      toastWrap.appendChild(el);
      setTimeout(() => {
        el.style.opacity = "0";
        el.style.transform = "translateY(10px)";
        el.style.transition = "all .25s ease";
      }, ttl - 250);
      setTimeout(() => el.remove(), ttl);
    }

    /* ===============================
       i18n (PT/EN)
       =============================== */
    const I18N = {
      pt: {
        portalName: "Hyundai Portal",
        loginHeroText: "Um portal moderno com acesso r√°pido a funcionalidades internas, documentos e comunica√ß√£o.",
        loginHeroNote: "Demo local (front-end). Para seguran√ßa real, use autentica√ß√£o no servidor.",
        chipModern: "Design Moderno",
        chipSmooth: "Anima√ß√µes Fluidas",
        chipFast: "Acesso R√°pido",
        signInTitle: "Entrar",
        signInSubtitle: "Use suas credenciais para acessar",
        emailLabel: "E-mail",
        emailPlaceholder: "ex: nome@empresa.com",
        passwordLabel: "Senha",
        passwordPlaceholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",
        demoHintTitle: "Contas demo",
        accessBtn: "Acessar",
        fillDemoBtn: "Preencher demo",
        kbdTip: "Dica: Alt + M abre o menu",
        welcomeDefault: "Bem-vindo(a)!",
        homeBtn: "In√≠cio",
        logoutBtn: "Sair",
        menuTitle: "Menu",
        sessionActive: "Sess√£o ativa",
        shortcuts: "Atalhos",
        escCloses: "Esc fecha",

        navHome: "üè† Home",
        navHomeMeta: "Vis√£o geral",
        navJournal: "üóûÔ∏è Jornal",
        navJournalMeta: "Arquivos mensais",
        navExpat: "‚úàÔ∏è Expatria√ß√£o",
        navExpatMeta: "Admin",
        navDocs: "üìÅ Documentos",
        navDocsMeta: "Arquivos",
        navSupport: "üõü Suporte",
        navSupportMeta: "Ajuda",

        homeHeroTitle: "Portal interno com acesso r√°pido",
        homeHeroSub: "Acesse funcionalidades essenciais, atualiza√ß√µes e documentos com uma experi√™ncia moderna, fluida e responsiva.",
        chipBlueWhite: "Azul & Branco",
        chipSidebar: "Menu lateral",
        chipTransitions: "Transi√ß√µes suaves",
        chipSPA: "SPA (telas internas)",
        goJournal: "Abrir Jornal",
        goDocs: "Ver Documentos",

        quickFeaturesTitle: "Funcionalidades r√°pidas",
        quickFeaturesSub: "Escolha uma √°rea para abrir a tela correspondente.",
        cardJRTitle: "Jornal",
        cardJRDesc: "Selecione o m√™s e abra arquivos do jornal interno.",
        cardEXTitle: "Expatria√ß√£o",
        cardEXDesc: "M√≥dulo de perfis e familiares (somente admin).",
        cardDOCTitle: "Documentos",
        cardDOCDesc: "Cat√°logo de arquivos, pol√≠ticas, formul√°rios e downloads essenciais.",

        updatesTitle: "Atualiza√ß√µes r√°pidas",
        update1Title: "Bem-vindo ao Hyundai Portal",
        update1Desc: "Use o menu hamb√∫rguer para navegar entre as telas.",
        updateJRTitle: "Jornal mensal",
        updateJRDesc: "Escolha de janeiro a dezembro para abrir os arquivos.",
        updateLangTitle: "Idiomas",
        updateLangDesc: "Voc√™ pode alternar entre Portugu√™s e Ingl√™s no topo.",

        // Journal
        jrTitle: "üóûÔ∏è Jornal (Janeiro a Dezembro)",
        jrSub: "Selecione um m√™s para ver os arquivos dispon√≠veis. Administradores podem adicionar/remover arquivos.",
        jrPickMonth: "Escolha um m√™s",
        jrAdminTitle: "Administra√ß√£o",
        jrMonthLabel: "M√™s",
        jrFileTitleLabel: "T√≠tulo do arquivo",
        jrFileTitlePh: "Ex: Jornal - Janeiro 2026",
        jrTypeLabel: "Tipo",
        jrTypeUrl: "Link (URL)",
        jrTypeUpload: "Upload (salvo no navegador)",
        jrUrlLabel: "URL",
        jrUrlPh: "https://...",
        jrUploadLabel: "Arquivo",
        jrUploadHint: "Upload √© uma demonstra√ß√£o: o arquivo fica salvo no navegador (localStorage) e pode ter limites de tamanho.",
        jrAddBtn: "Adicionar",
        jrClearAll: "Limpar todos (admin)",
        jrExport: "Exportar lista",
        jrImport: "Importar lista",
        jrTip1T: "Dica",
        jrTip1D: "Para ‚Äúhospedar‚Äù de verdade, use links do SharePoint/Drive e cadastre aqui.",
        jrTip2T: "Permiss√µes",
        jrTip2D: "Somente admin v√™ o painel de adicionar/remover.",
        jrNoFiles: "Nenhum arquivo neste m√™s ainda.",
        jrOpen: "Abrir",
        jrDownload: "Baixar",
        jrRemove: "Remover",
        jrFilesAvailable: "Arquivos dispon√≠veis",

        // Expat (profiles)
        exNewTitle: "‚úàÔ∏è Expatria√ß√£o ‚Äî Perfis",
        exNewSub: "M√≥dulo de perfis (admin). Gerencie dados do usu√°rio e familiares com layout moderno.",
        exDirectoryTitle: "Diret√≥rio",
        exDirectorySub: "Usu√°rios e familiares",
        exCollapse: "Recolher",
        exUsersTitle: "Usu√°rios",
        exFamilyTitle: "Fam√≠lia",
        exSearchLabel: "Buscar",
        exSearchPh: "Nome ou e-mail...",
        exUserNamePh: "Nome",
        exUserEmailPh: "email@empresa.com",
        exAddUser: "Adicionar usu√°rio",
        exFamilyNamePh: "Nome",
        exFamilyRelationPh: "Parentesco",
        exAddFamily: "Adicionar familiar",
        exFamilyHint: "Selecione um usu√°rio antes de adicionar familiares.",
        exAddPhoto: "Adicionar foto",
        exRemovePhoto: "Remover foto",
        exDeleteProfile: "Excluir perfil",
        exTabData: "Dados",
        exTabFeed: "Atividade",
        exDocTitle: "Documentos / Dados",
        exCpf: "CPF",
        exRne: "RNE",
        exCnh: "CNH",
        exHouse: "Casa",
        exPassport: "Passaporte",
        exSaveNew: "Salvar altera√ß√µes",
        exPrivacy: "Demo: dados s√£o salvos no navegador (localStorage). Em produ√ß√£o, use backend seguro.",
        exSelected: "Selecionado",
        exFeedTitle: "Atividade",
        exTipsTitle: "Boas pr√°ticas",
        exTipsSub: "Para ‚Äúacesso real‚Äù, salve arquivos/documentos em SharePoint/Drive e referencie links aqui.",

        // Docs
        docsTitle: "üìÅ Documentos",
        docsSub: "Cat√°logo de documentos (exemplo). Voc√™ pode trocar por links reais ou integra√ß√µes.",
        docsSearchTitle: "Buscar",
        docsSearchLabel: "Pesquisar documento",
        docsSearchPh: "Ex: Pol√≠tica, Formul√°rio, Manual...",
        docsShortcuts: "Atalhos",
        docsS1T: "Pol√≠ticas internas",
        docsS1D: "Acesse documentos institucionais e regras atualizadas.",
        docsS2T: "Formul√°rios",
        docsS2D: "Modelos prontos para solicita√ß√µes e processos.",
        docsS3T: "Manuais",
        docsS3D: "Guias de uso e instru√ß√µes operacionais.",
        docsOpen: "Abrir",
        docsNoResultsTitle: "Nenhum resultado",
        docsNoResultsDesc: "Tente outro termo de busca.",

        // Support
        supTitle: "üõü Suporte",
        supSub: "Abra uma solicita√ß√£o (demo) ou registre uma d√∫vida. Ideal para integrar com Service Desk.",
        supNew: "Nova solicita√ß√£o",
        supTitleLabel: "T√≠tulo",
        supTitlePh: "Ex: Acesso ao sistema",
        supDescLabel: "Descri√ß√£o",
        supDescPh: "Descreva o problema...",
        supSend: "Enviar (demo)",
        supHint: "Para produ√ß√£o, enviar para API/servidor e gerar ticket.",
        supBest: "Boas pr√°ticas",
        supB1T: "Inclua prints e contexto",
        supB1D: "Ajuda o time a reproduzir e resolver mais r√°pido.",
        supB2T: "Informe seu usu√°rio e setor",
        supB2D: "Facilita a valida√ß√£o de permiss√µes e acessos.",

        // Toasts/system
        toastOpened: "Tela aberta",
        toastLoginOk: "Login realizado",
        toastLoginOkD: "Acesso liberado ao Hyundai Portal.",
        toastLoginBad: "Credenciais inv√°lidas",
        toastLoginBadD: "Use admin@hyundai.com/admin123 ou user@hyundai.com/portal123 (demo).",
        toastRequired: "Campos obrigat√≥rios",
        toastRequiredD: "Preencha e-mail e senha.",
        toastEmailInvalid: "E-mail inv√°lido",
        toastEmailInvalidD: "Informe um e-mail v√°lido.",
        toastDemoFilled: "Demo preenchida",
        toastDemoFilledD: "Clique em Acessar para entrar.",
        toastLoggedOut: "Sess√£o encerrada",
        toastLoggedOutD: "Voc√™ saiu do portal.",
        toastAdded: "Adicionado",
        toastRemoved: "Removido",
        toastSaved: "Salvo",
        toastImported: "Importado",
        toastExported: "Exportado",
        toastDenied: "Acesso negado",
        toastDeniedD: "Apenas administradores podem acessar/alterar esta se√ß√£o."
      },

      en: {
        portalName: "Hyundai Portal",
        loginHeroText: "A modern portal with quick access to internal features, documents, and communications.",
        loginHeroNote: "Local demo (front-end). For real security, use server-side authentication.",
        chipModern: "Modern Design",
        chipSmooth: "Smooth Animations",
        chipFast: "Quick Access",
        signInTitle: "Sign in",
        signInSubtitle: "Use your credentials to access",
        emailLabel: "Email",
        emailPlaceholder: "e.g., name@company.com",
        passwordLabel: "Password",
        passwordPlaceholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",
        demoHintTitle: "Demo accounts",
        accessBtn: "Access",
        fillDemoBtn: "Fill demo",
        kbdTip: "Tip: Alt + M opens the menu",
        welcomeDefault: "Welcome!",
        homeBtn: "Home",
        logoutBtn: "Logout",
        menuTitle: "Menu",
        sessionActive: "Active session",
        shortcuts: "Shortcuts",
        escCloses: "Esc closes",

        navHome: "üè† Home",
        navHomeMeta: "Overview",
        navJournal: "üóûÔ∏è Journal",
        navJournalMeta: "Monthly files",
        navExpat: "‚úàÔ∏è Expatriation",
        navExpatMeta: "Admin",
        navDocs: "üìÅ Documents",
        navDocsMeta: "Files",
        navSupport: "üõü Support",
        navSupportMeta: "Help",

        homeHeroTitle: "Internal portal with quick access",
        homeHeroSub: "Access essential features, updates, and documents with a modern, smooth, responsive experience.",
        chipBlueWhite: "Blue & White",
        chipSidebar: "Sidebar menu",
        chipTransitions: "Smooth transitions",
        chipSPA: "SPA (internal screens)",
        goJournal: "Open Journal",
        goDocs: "View Documents",

        quickFeaturesTitle: "Quick features",
        quickFeaturesSub: "Choose an area to open the corresponding screen.",
        cardJRTitle: "Journal",
        cardJRDesc: "Pick a month and open internal journal files.",
        cardEXTitle: "Expatriation",
        cardEXDesc: "Profiles and family module (admin only).",
        cardDOCTitle: "Documents",
        cardDOCDesc: "Catalog of files, policies, forms, and essential downloads.",

        updatesTitle: "Quick updates",
        update1Title: "Welcome to Hyundai Portal",
        update1Desc: "Use the hamburger menu to navigate between screens.",
        updateJRTitle: "Monthly journal",
        updateJRDesc: "Choose from January to December to open files.",
        updateLangTitle: "Languages",
        updateLangDesc: "You can switch between Portuguese and English at the top.",

        jrTitle: "üóûÔ∏è Journal (January to December)",
        jrSub: "Select a month to see available files. Admins can add/remove files.",
        jrPickMonth: "Choose a month",
        jrAdminTitle: "Administration",
        jrMonthLabel: "Month",
        jrFileTitleLabel: "File title",
        jrFileTitlePh: "e.g., Journal - January 2026",
        jrTypeLabel: "Type",
        jrTypeUrl: "Link (URL)",
        jrTypeUpload: "Upload (saved in browser)",
        jrUrlLabel: "URL",
        jrUrlPh: "https://...",
        jrUploadLabel: "File",
        jrUploadHint: "Upload is a demo: the file is stored in your browser (localStorage) and may hit size limits.",
        jrAddBtn: "Add",
        jrClearAll: "Clear all (admin)",
        jrExport: "Export list",
        jrImport: "Import list",
        jrTip1T: "Tip",
        jrTip1D: "To truly host files, use SharePoint/Drive links and register them here.",
        jrTip2T: "Permissions",
        jrTip2D: "Only admins see the add/remove panel.",
        jrNoFiles: "No files for this month yet.",
        jrOpen: "Open",
        jrDownload: "Download",
        jrRemove: "Remove",
        jrFilesAvailable: "Files available",

        exNewTitle: "‚úàÔ∏è Expatriation ‚Äî Profiles",
        exNewSub: "Profiles module (admin). Manage user and family data with a modern layout.",
        exDirectoryTitle: "Directory",
        exDirectorySub: "Users and family",
        exCollapse: "Collapse",
        exUsersTitle: "Users",
        exFamilyTitle: "Family",
        exSearchLabel: "Search",
        exSearchPh: "Name or email...",
        exUserNamePh: "Name",
        exUserEmailPh: "email@company.com",
        exAddUser: "Add user",
        exFamilyNamePh: "Name",
        exFamilyRelationPh: "Relation",
        exAddFamily: "Add family member",
        exFamilyHint: "Select a user before adding family members.",
        exAddPhoto: "Add photo",
        exRemovePhoto: "Remove photo",
        exDeleteProfile: "Delete profile",
        exTabData: "Data",
        exTabFeed: "Activity",
        exDocTitle: "Documents / Data",
        exCpf: "CPF",
        exRne: "RNE",
        exCnh: "Driver's License",
        exHouse: "Home",
        exPassport: "Passport",
        exSaveNew: "Save changes",
        exPrivacy: "Demo: data is stored in your browser (localStorage). In production, use a secure backend.",
        exSelected: "Selected",
        exFeedTitle: "Activity",
        exTipsTitle: "Best practices",
        exTipsSub: "For real access, store documents in SharePoint/Drive and reference links here.",

        docsTitle: "üìÅ Documents",
        docsSub: "Document catalog (example). Replace with real links or integrations.",
        docsSearchTitle: "Search",
        docsSearchLabel: "Search document",
        docsSearchPh: "e.g., Policy, Form, Manual...",
        docsShortcuts: "Shortcuts",
        docsS1T: "Internal policies",
        docsS1D: "Access institutional documents and updated rules.",
        docsS2T: "Forms",
        docsS2D: "Ready-made templates for requests and processes.",
        docsS3T: "Manuals",
        docsS3D: "Usage guides and operational instructions.",
        docsOpen: "Open",
        docsNoResultsTitle: "No results",
        docsNoResultsDesc: "Try another search term.",

        supTitle: "üõü Support",
        supSub: "Open a request (demo) or ask a question. Great to integrate with a Service Desk.",
        supNew: "New request",
        supTitleLabel: "Title",
        supTitlePh: "e.g., System access",
        supDescLabel: "Description",
        supDescPh: "Describe the issue...",
        supSend: "Send (demo)",
        supHint: "For production, send to an API/server and generate a ticket.",
        supBest: "Best practices",
        supB1T: "Include screenshots and context",
        supB1D: "Helps the team reproduce and resolve faster.",
        supB2T: "Provide your user and department",
        supB2D: "Makes permission and access validation easier.",

        toastOpened: "Screen opened",
        toastLoginOk: "Login successful",
        toastLoginOkD: "Access granted to Hyundai Portal.",
        toastLoginBad: "Invalid credentials",
        toastLoginBadD: "Use admin@hyundai.com/admin123 or user@hyundai.com/portal123 (demo).",
        toastRequired: "Required fields",
        toastRequiredD: "Fill in email and password.",
        toastEmailInvalid: "Invalid email",
        toastEmailInvalidD: "Please enter a valid email.",
        toastDemoFilled: "Demo filled",
        toastDemoFilledD: "Click Access to sign in.",
        toastLoggedOut: "Session ended",
        toastLoggedOutD: "You logged out.",
        toastAdded: "Added",
        toastRemoved: "Removed",
        toastSaved: "Saved",
        toastImported: "Imported",
        toastExported: "Exported",
        toastDenied: "Access denied",
        toastDeniedD: "Only administrators can access/modify this section."
      }
    };

    const LANG_KEY = "hyundai_portal_lang";
    let currentLang = localStorage.getItem(LANG_KEY) || "pt";
    function t(key){
      return (I18N[currentLang] && I18N[currentLang][key]) ? I18N[currentLang][key] : (I18N.pt[key] || key);
    }

    function applyI18n(){
      $$("[data-i18n]").forEach(el => el.textContent = t(el.getAttribute("data-i18n")));
      $$("[data-i18n-placeholder]").forEach(el => el.setAttribute("placeholder", t(el.getAttribute("data-i18n-placeholder"))));
      document.documentElement.lang = (currentLang === "en") ? "en" : "pt-BR";
      $("#langSelectLogin").value = currentLang;
      $("#langSelectApp").value = currentLang;

      // Refresh dynamic views
      renderJournal();
      renderDocs($("#docSearch")?.value || "");
      expRender();
      syncNavPermissions();
      syncRolePill();
    }

    function setLang(lang){
      currentLang = (lang === "en") ? "en" : "pt";
      localStorage.setItem(LANG_KEY, currentLang);
      applyI18n();
    }

    $("#langSelectLogin")?.addEventListener("change", e => setLang(e.target.value));
    $("#langSelectApp")?.addEventListener("change", e => setLang(e.target.value));

    /* ===============================
       Sidebar
       =============================== */
    const hamburger = $("#hamburger");
    const sidebar = $("#sidebar");
    const overlay = $("#overlay");
    const closeSidebarBtn = $("#closeSidebarBtn");

    function openSidebar(){
      sidebar.classList.add("open");
      overlay.classList.add("show");
      hamburger.dataset.open = "true";
      hamburger.setAttribute("aria-expanded", "true");
      overlay.setAttribute("aria-hidden", "false");
    }
    function closeSidebar(){
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
      hamburger.dataset.open = "false";
      hamburger.setAttribute("aria-expanded", "false");
      overlay.setAttribute("aria-hidden", "true");
    }

    hamburger?.addEventListener("click", () => sidebar.classList.contains("open") ? closeSidebar() : openSidebar());
    overlay?.addEventListener("click", closeSidebar);
    closeSidebarBtn?.addEventListener("click", closeSidebar);

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeSidebar();
      if (e.altKey && (e.key.toLowerCase() === "m")) {
        e.preventDefault();
        sidebar.classList.contains("open") ? closeSidebar() : openSidebar();
      }
    });

    /* ===============================
       Auth (Admin/User)
       =============================== */
    const loginView = $("#loginView");
    const appView = $("#appView");
    const loginForm = $("#loginForm");
    const fillDemoBtn = $("#fillDemoBtn");
    const welcomeText = $("#welcomeText");
    const userMeta = $("#userMeta");
    const logoutBtn = $("#logoutBtn");
    const rolePill = $("#rolePill");

    const AUTH_KEY = "hyundai_portal_session";
    const DEMO = {
      admin: { email:"admin@hyundai.com", pass:"admin123", role:"admin" },
      user:  { email:"user@hyundai.com",  pass:"portal123", role:"user"  }
    };

    function setSession(email, role){
      localStorage.setItem(AUTH_KEY, JSON.stringify({ email, role, at: Date.now() }));
    }
    function getSession(){
      try { return JSON.parse(localStorage.getItem(AUTH_KEY) || "null"); }
      catch { return null; }
    }
    function clearSession(){ localStorage.removeItem(AUTH_KEY); }

    function isValidEmail(email){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    let session = null;

    function syncRolePill(){
      if (!rolePill) return;
      if (!session?.role){
        rolePill.style.display = "none";
        return;
      }
      rolePill.style.display = "inline-flex";
      rolePill.textContent = (session.role === "admin")
        ? (currentLang==="en" ? "üëë ADMIN" : "üëë ADMIN")
        : (currentLang==="en" ? "üë§ USER" : "üë§ USU√ÅRIO");
    }

    function syncNavPermissions(){
      const expBtn = $("#navExpatBtn");
      if (!expBtn) return;

      const isAdmin = session?.role === "admin";
      expBtn.style.opacity = isAdmin ? "1" : "0.55";
      expBtn.title = isAdmin ? "" : (currentLang==="en" ? "Admins only" : "Apenas admin");
    }

    function enterApp(sess){
      session = sess;
      loginView.style.display = "none";
      appView.classList.add("show");
      appView.setAttribute("aria-hidden", "false");

      const email = sess.email || "";
      welcomeText.textContent = (currentLang === "en") ? `Welcome, ${email}!` : `Bem-vindo(a), ${email}!`;
      userMeta.textContent = (currentLang === "en") ? `User: ${email}` : `Usu√°rio: ${email}`;

      syncRolePill();
      syncNavPermissions();
      updateJournalAdminUI();

      // bind expat once (admin only)
      if (session?.role === "admin" && !window.__expBound){
        window.__expBound = true;
        expBind();
      }

      showPage("home");
      toast(t("toastLoginOk"), t("toastLoginOkD"), "success");
    }

    function exitApp(){
      clearSession();
      session = null;
      appView.classList.remove("show");
      appView.setAttribute("aria-hidden", "true");
      loginView.style.display = "grid";
      closeSidebar();
      toast(t("toastLoggedOut"), t("toastLoggedOutD"), "info");
    }

    fillDemoBtn?.addEventListener("click", () => {
      $("#email").value = DEMO.user.email;
      $("#pass").value = DEMO.user.pass;
      toast(t("toastDemoFilled"), t("toastDemoFilledD"), "info", 2200);
    });

    loginForm?.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = ($("#email").value || "").trim().toLowerCase();
      const pass  = ($("#pass").value || "");

      if (!email || !pass){
        toast(t("toastRequired"), t("toastRequiredD"), "danger");
        return;
      }
      if (!isValidEmail(email)){
        toast(t("toastEmailInvalid"), t("toastEmailInvalidD"), "danger");
        return;
      }

      const isAdmin = (email === DEMO.admin.email && pass === DEMO.admin.pass);
      const isUser  = (email === DEMO.user.email  && pass === DEMO.user.pass);

      if (isAdmin){
        setSession(email, "admin");
        enterApp({ email, role:"admin" });
      } else if (isUser){
        setSession(email, "user");
        enterApp({ email, role:"user" });
      } else {
        toast(t("toastLoginBad"), t("toastLoginBadD"), "danger");
      }
    });

    logoutBtn?.addEventListener("click", exitApp);

    /* ===============================
       SPA routing (with admin guard)
       =============================== */
    const pages = ["home","journal","expatriacao","documentos","suporte"];

    function pageLabel(page){
      const map = {
        home: currentLang==="en" ? "Home" : "Home",
        journal: currentLang==="en" ? "Journal" : "Jornal",
        expatriacao: currentLang==="en" ? "Expatriation" : "Expatria√ß√£o",
        documentos: currentLang==="en" ? "Documents" : "Documentos",
        suporte: currentLang==="en" ? "Support" : "Suporte"
      };
      return map[page] || page;
    }

    function showPage(page){
      // üîí Admin-only guard for Expatria√ß√£o
      if (page === "expatriacao" && session?.role !== "admin") {
        toast(t("toastDenied"), t("toastDeniedD"), "danger");
        page = "home";
      }

      pages.forEach(p => $("#page-" + p)?.classList.toggle("show", p === page));
      $$("#nav button").forEach(btn => btn.classList.toggle("active", btn.dataset.page === page));
      closeSidebar();
      toast(t("toastOpened"), pageLabel(page), "success", 1400);
      window.scrollTo({ top: 0, behavior: "smooth" });

      // refresh dynamic when entering specific pages
      if (page === "journal") renderJournal();
      if (page === "expatriacao") expRender();
      if (page === "documentos") renderDocs($("#docSearch")?.value || "");
    }

    $("#nav")?.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-page]");
      if (!btn) return;

      // block directly
      if (btn.dataset.page === "expatriacao" && session?.role !== "admin") {
        toast(t("toastDenied"), t("toastDeniedD"), "danger");
        return;
      }
      showPage(btn.dataset.page);
    });

    document.addEventListener("click", (e) => {
      const go = e.target.closest("[data-goto]");
      if (!go) return;
      const page = go.dataset.goto;
      if (pages.includes(page)) showPage(page);
    });

    document.addEventListener("keydown", (e) => {
      const card = e.target.closest(".card[data-goto]");
      if (!card) return;
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        showPage(card.dataset.goto);
      }
    });

    $("#goHomeBtn")?.addEventListener("click", () => showPage("home"));

    /* ===============================
       JOURNAL (Monthly files) ‚Äî Admin CRUD
       =============================== */
    const JR_KEY = "hyundai_portal_journal_files_v1";
    const months = [
      { key:"jan", pt:"Janeiro",   en:"January" },
      { key:"feb", pt:"Fevereiro", en:"February" },
      { key:"mar", pt:"Mar√ßo",     en:"March" },
      { key:"apr", pt:"Abril",     en:"April" },
      { key:"may", pt:"Maio",      en:"May" },
      { key:"jun", pt:"Junho",     en:"June" },
      { key:"jul", pt:"Julho",     en:"July" },
      { key:"aug", pt:"Agosto",    en:"August" },
      { key:"sep", pt:"Setembro",  en:"September" },
      { key:"oct", pt:"Outubro",   en:"October" },
      { key:"nov", pt:"Novembro",  en:"November" },
      { key:"dec", pt:"Dezembro",  en:"December" },
    ];

    const jrMonthGrid = $("#jrMonthGrid");
    const jrFileList = $("#jrFileList");
    const jrMonthTitle = $("#jrMonthTitle");
    const jrMonthSubtitle = $("#jrMonthSubtitle");
    const jrAdminPanel = $("#jrAdminPanel");
    const jrAdminNote = $("#jrAdminNote");
    const jrMonthSelect = $("#jrMonthSelect");
    const jrAddForm = $("#jrAddForm");
    const jrTitleInput = $("#jrTitleInput");
    const jrTypeSelect = $("#jrTypeSelect");
    const jrUrlWrap = $("#jrUrlWrap");
    const jrUrlInput = $("#jrUrlInput");
    const jrUploadWrap = $("#jrUploadWrap");
    const jrFileInput = $("#jrFileInput");
    const jrClearAllBtn = $("#jrClearAllBtn");
    const jrStorageHint = $("#jrStorageHint");
    const jrExportBtn = $("#jrExportBtn");
    const jrImportBtn = $("#jrImportBtn");
    const jrImportFile = $("#jrImportFile");

    let activeMonthKey = "jan";

    function jrGet(){
      try{
        const raw = JSON.parse(localStorage.getItem(JR_KEY) || "{}");
        months.forEach(m => { if (!raw[m.key]) raw[m.key] = []; });
        return raw;
      }catch{
        const init = {};
        months.forEach(m => init[m.key] = []);
        return init;
      }
    }
    function jrSet(data){
      localStorage.setItem(JR_KEY, JSON.stringify(data));
    }

    function monthName(key){
      const m = months.find(x => x.key === key);
      if (!m) return key;
      return currentLang === "en" ? m.en : m.pt;
    }

    function updateJournalAdminUI(){
      const isAdmin = session?.role === "admin";
      if (!jrAdminPanel) return;

      jrAdminPanel.style.display = isAdmin ? "block" : "none";
      jrAdminNote.textContent = isAdmin
        ? (currentLang === "en" ? "You are logged in as admin. You can add/remove files." : "Voc√™ est√° logado como admin. Voc√™ pode adicionar/remover arquivos.")
        : (currentLang === "en" ? "Login as admin to manage files." : "Fa√ßa login como admin para gerenciar arquivos.");

      jrStorageHint.textContent = (currentLang === "en")
        ? "Storage: URL links recommended ‚Ä¢ Upload = browser localStorage (size-limited)"
        : "Armazenamento: Links URL recomendado ‚Ä¢ Upload = localStorage do navegador (limitado)";
    }

    function renderJournalMonthGrid(){
      const data = jrGet();
      jrMonthGrid.innerHTML = "";
      months.forEach(m => {
        const count = (data[m.key] || []).length;
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "month-btn" + (m.key === activeMonthKey ? " active" : "");
        btn.innerHTML = `
          <span>${escapeHtml(monthName(m.key))}</span>
          <span class="badge-small">${count}</span>
        `;
        btn.addEventListener("click", () => {
          activeMonthKey = m.key;
          renderJournal();
        });
        jrMonthGrid.appendChild(btn);
      });
    }

    function journalFileRow(item, isAdmin){
      const date = new Date(item.addedAt || Date.now()).toLocaleString();
      const title = escapeHtml(item.title || "‚Äî");
      const sub = item.type === "url"
        ? `${currentLang==="en" ? "Link" : "Link"} ‚Ä¢ ${date}`
        : `${currentLang==="en" ? "Upload" : "Upload"} ‚Ä¢ ${escapeHtml(item.fileName || "")} ‚Ä¢ ${date}`;

      const openHref = item.type === "url" ? item.url : item.dataUrl;

      const openBtn = `
        <a class="btn btn-ghost" href="${escapeHtml(openHref)}" target="_blank" rel="noopener">
          <span aria-hidden="true">üîé</span> ${escapeHtml(t("jrOpen"))}
        </a>
      `;

      const dlBtn = (item.type === "upload")
        ? `<a class="btn btn-ghost" href="${escapeHtml(openHref)}" download="${escapeHtml(item.fileName || "file")}">
             <span aria-hidden="true">‚¨á</span> ${escapeHtml(t("jrDownload"))}
           </a>`
        : "";

      const removeBtn = isAdmin
        ? `<button class="btn btn-danger" type="button" data-jr-remove="${escapeHtml(item.id)}">
             <span aria-hidden="true">üóë</span> ${escapeHtml(t("jrRemove"))}
           </button>`
        : "";

      return `
        <div class="item">
          <span class="dot" aria-hidden="true"></span>
          <div style="width:100%;">
            <p class="t">${title}</p>
            <p class="d">${sub}</p>
            <div class="file-actions">
              ${openBtn}
              ${dlBtn}
              ${removeBtn}
            </div>
          </div>
        </div>
      `;
    }

    function populateMonthSelect(){
      jrMonthSelect.innerHTML = months.map(m => {
        const label = monthName(m.key);
        return `<option value="${m.key}">${escapeHtml(label)}</option>`;
      }).join("");
      jrMonthSelect.value = activeMonthKey;
    }

    function renderJournalFileList(){
      const data = jrGet();
      const isAdmin = session?.role === "admin";
      const list = (data[activeMonthKey] || []).slice().sort((a,b) => (b.addedAt||0) - (a.addedAt||0));

      jrMonthTitle.textContent = monthName(activeMonthKey);
      jrMonthSubtitle.textContent = `${t("jrFilesAvailable")}: ${list.length}`;

      if (!list.length){
        jrFileList.innerHTML = `
          <div class="item">
            <span class="dot" aria-hidden="true"></span>
            <div>
              <p class="t">${escapeHtml(t("jrNoFiles"))}</p>
              <p class="d">${escapeHtml(currentLang==="en" ? "Ask an admin to add files for this month." : "Pe√ßa para um admin adicionar arquivos para este m√™s.")}</p>
            </div>
          </div>`;
        return;
      }

      jrFileList.innerHTML = list.map(it => journalFileRow(it, isAdmin)).join("");

      // Remove bindings
      $$("[data-jr-remove]", jrFileList).forEach(btn => {
        btn.addEventListener("click", () => {
          if (session?.role !== "admin"){
            toast(t("toastDenied"), t("toastDeniedD"), "danger");
            return;
          }
          const id = btn.getAttribute("data-jr-remove");
          const d = jrGet();
          d[activeMonthKey] = (d[activeMonthKey] || []).filter(x => x.id !== id);
          jrSet(d);
          toast(t("toastRemoved"), monthName(activeMonthKey), "info");
          renderJournal();
        });
      });
    }

    function renderJournal(){
      if (!jrMonthGrid || !jrFileList) return;
      populateMonthSelect();
      renderJournalMonthGrid();
      renderJournalFileList();
      updateJournalAdminUI();
    }

    jrTypeSelect?.addEventListener("change", () => {
      const v = jrTypeSelect.value;
      jrUrlWrap.style.display = (v === "url") ? "block" : "none";
      jrUploadWrap.style.display = (v === "upload") ? "block" : "none";
    });

    jrAddForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (session?.role !== "admin"){
        toast(t("toastDenied"), t("toastDeniedD"), "danger");
        return;
      }

      const mKey = jrMonthSelect.value;
      const title = (jrTitleInput.value || "").trim();
      const type = jrTypeSelect.value;

      if (!title){
        toast(t("toastRequired"), currentLang==="en" ? "Provide a title." : "Informe um t√≠tulo.", "danger");
        return;
      }

      const data = jrGet();
      const item = {
        id: crypto?.randomUUID ? crypto.randomUUID() : ("id_" + Math.random().toString(16).slice(2)),
        title,
        type,
        addedAt: Date.now(),
      };

      if (type === "url"){
        const url = (jrUrlInput.value || "").trim();
        if (!url){
          toast(t("toastRequired"), currentLang==="en" ? "Provide a URL." : "Informe uma URL.", "danger");
          return;
        }
        item.url = url;
      } else {
        const f = jrFileInput.files && jrFileInput.files[0];
        if (!f){
          toast(t("toastRequired"), currentLang==="en" ? "Choose a file." : "Selecione um arquivo.", "danger");
          return;
        }
        item.fileName = f.name;
        item.mime = f.type || "application/octet-stream";
        item.dataUrl = await readFileAsDataURL(f);
      }

      data[mKey] = data[mKey] || [];
      data[mKey].push(item);
      jrSet(data);

      jrTitleInput.value = "";
      jrUrlInput.value = "";
      jrFileInput.value = "";

      activeMonthKey = mKey;
      toast(t("toastAdded"), monthName(mKey), "success");
      renderJournal();
    });

    jrClearAllBtn?.addEventListener("click", () => {
      if (session?.role !== "admin"){
        toast(t("toastDenied"), t("toastDeniedD"), "danger");
        return;
      }
      const cleared = {};
      months.forEach(m => cleared[m.key] = []);
      jrSet(cleared);
      toast(t("toastSaved"), currentLang==="en" ? "Journal cleared." : "Jornal limpo.", "info");
      renderJournal();
    });

    jrExportBtn?.addEventListener("click", () => {
      const data = jrGet();
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: "application/json;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "journal_files.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      toast(t("toastExported"), "journal_files.json", "success");
    });

    jrImportBtn?.addEventListener("click", () => jrImportFile?.click());
    jrImportFile?.addEventListener("change", async () => {
      if (!jrImportFile.files?.[0]) return;
      try{
        const text = await jrImportFile.files[0].text();
        const parsed = JSON.parse(text);
        months.forEach(m => { if (!parsed[m.key]) parsed[m.key] = []; });
        jrSet(parsed);
        toast(t("toastImported"), currentLang==="en" ? "Imported list." : "Lista importada.", "success");
        renderJournal();
      }catch{
        toast(currentLang==="en" ? "Import failed" : "Falha ao importar",
              currentLang==="en" ? "Invalid JSON file." : "Arquivo JSON inv√°lido.", "danger");
      }finally{
        jrImportFile.value = "";
      }
    });

    /* ===============================
       EXPAT Profiles (ADMIN ONLY)
       =============================== */
    const EXP_PROFILES_KEY = "hyundai_portal_expat_profiles_v1";

    function expLoad(){
      try{
        return JSON.parse(localStorage.getItem(EXP_PROFILES_KEY) || '{"users":[],"activity":[]}');
      } catch {
        return { users: [], activity: [] };
      }
    }
    function expSave(db){
      localStorage.setItem(EXP_PROFILES_KEY, JSON.stringify(db));
    }

    let expState = {
      selectedUserId: null,
      selectedMemberId: null,
      mode: "user"
    };

    function expIsAdmin(){
      return session?.role === "admin";
    }

    function expLog(action, who){
      const db = expLoad();
      db.activity = db.activity || [];
      db.activity.unshift({
        id: crypto?.randomUUID ? crypto.randomUUID() : ("a_" + Math.random().toString(16).slice(2)),
        at: Date.now(),
        action,
        who
      });
      db.activity = db.activity.slice(0, 30);
      expSave(db);
    }

    function expGetSelected(db){
      const user = db.users.find(u => u.id === expState.selectedUserId) || null;
      if (!user) return { user:null, member:null };
      if (expState.mode === "family"){
        const member = (user.family || []).find(m => m.id === expState.selectedMemberId) || null;
        return { user, member };
      }
      return { user, member:null };
    }

    function expUserDisplay(u){
      const name = u?.name || "‚Äî";
      const email = u?.email || "";
      return { name, meta: email ? email : (currentLang==="en" ? "Employee" : "Colaborador") };
    }

    function expMemberDisplay(m){
      const name = m?.name || "‚Äî";
      const rel = m?.relation || "";
      return { name, meta: rel ? rel : (currentLang==="en" ? "Family member" : "Familiar") };
    }

    function expRender(){
      if (!$("#page-expatriacao")) return;

      // If not admin, don't render (guard already in routing)
      if (!expIsAdmin()) return;

      const db = expLoad();

      const userList = $("#expUserList");
      const familyList = $("#expFamilyList");
      const usersCount = $("#expUsersCount");
      const famCount = $("#expFamilyCount");
      const search = $("#expUserSearch");

      const avatarImg = $("#expAvatarImg");
      const avatarFallback = $("#expAvatarFallback");
      const displayName = $("#expDisplayName");
      const displayMeta = $("#expDisplayMeta");
      const lastUpdated = $("#expLastUpdated");
      const selectedInfo = $("#expSelectedInfo");
      const feed = $("#expFeed");

      if (db.users.length && !expState.selectedUserId){
        expState.selectedUserId = db.users[0].id;
        expState.mode = "user";
        expState.selectedMemberId = null;
      }
      if (!db.users.length){
        expState.selectedUserId = null;
        expState.mode = "user";
        expState.selectedMemberId = null;
      }

      // Users list
      const q = (search?.value || "").trim().toLowerCase();
      const usersFiltered = db.users.filter(u =>
        !q ||
        (u.name||"").toLowerCase().includes(q) ||
        (u.email||"").toLowerCase().includes(q)
      );

      usersCount.textContent = String(db.users.length);

      userList.innerHTML = usersFiltered.length
        ? usersFiltered.map(u => {
            const active = (u.id === expState.selectedUserId) && expState.mode==="user";
            const mini = u.photoDataUrl
              ? `<img src="${escapeHtml(u.photoDataUrl)}" alt="photo"/>`
              : `üë§`;
            return `
              <div class="exp-entry ${active ? "active":""}" data-exp-user="${escapeHtml(u.id)}">
                <div class="mini-avatar">${mini}</div>
                <div class="txt">
                  <b>${escapeHtml(u.name || "‚Äî")}</b>
                  <small>${escapeHtml(u.email || "")}</small>
                </div>
              </div>
            `;
          }).join("")
        : `<div class="item"><span class="dot"></span><div><p class="t">${escapeHtml(currentLang==="en"?"No users":"Nenhum usu√°rio")}</p><p class="d">${escapeHtml(currentLang==="en"?"Add a user to start.":"Adicione um usu√°rio para come√ßar.")}</p></div></div>`;

      // Family list
      const selectedUser = db.users.find(u => u.id === expState.selectedUserId) || null;
      const fam = selectedUser?.family || [];
      famCount.textContent = String(fam.length);

      familyList.innerHTML = selectedUser
        ? (fam.length
          ? fam.map(m => {
              const active = (m.id === expState.selectedMemberId) && expState.mode==="family";
              const mini = m.photoDataUrl ? `<img src="${escapeHtml(m.photoDataUrl)}" alt="photo"/>` : `üë™`;
              return `
                <div class="exp-entry ${active ? "active":""}" data-exp-family="${escapeHtml(m.id)}">
                  <div class="mini-avatar">${mini}</div>
                  <div class="txt">
                    <b>${escapeHtml(m.name || "‚Äî")}</b>
                    <small>${escapeHtml(m.relation || "")}</small>
                  </div>
                </div>
              `;
            }).join("")
          : `<div class="item"><span class="dot"></span><div><p class="t">${escapeHtml(currentLang==="en"?"No family profiles":"Sem perfis de fam√≠lia")}</p><p class="d">${escapeHtml(currentLang==="en"?"Add family members for this user.":"Adicione familiares para este usu√°rio.")}</p></div></div>`
        )
        : `<div class="item"><span class="dot"></span><div><p class="t">${escapeHtml(currentLang==="en"?"Select a user":"Selecione um usu√°rio")}</p><p class="d">${escapeHtml(currentLang==="en"?"Family profiles will show here.":"Os familiares aparecer√£o aqui.")}</p></div></div>`;

      // Selected entity
      const { user, member } = expGetSelected(db);
      const entity = (expState.mode === "family") ? member : user;

      const disp = (expState.mode === "family") ? expMemberDisplay(entity) : expUserDisplay(entity);
      displayName.textContent = disp.name;
      displayMeta.textContent = disp.meta;

      const updatedAt = entity?.updatedAt ? new Date(entity.updatedAt).toLocaleString() : "‚Äî";
      lastUpdated.textContent = (currentLang==="en" ? "Updated: " : "Atualizado: ") + updatedAt;

      // Avatar
      const photo = entity?.photoDataUrl || "";
      if (photo){
        avatarImg.src = photo;
        avatarImg.style.display = "block";
        avatarFallback.style.display = "none";
      } else {
        avatarImg.removeAttribute("src");
        avatarImg.style.display = "none";
        avatarFallback.style.display = "grid";
        avatarFallback.textContent = expState.mode === "family" ? "üë™" : "üë§";
      }

      // Selected info
      selectedInfo.innerHTML = `
        <div class="item">
          <span class="dot"></span>
          <div>
            <p class="t">${escapeHtml(currentLang==="en" ? "Mode" : "Modo")}</p>
            <p class="d">${escapeHtml(expState.mode === "family" ? (currentLang==="en" ? "Family profile" : "Perfil de familiar") : (currentLang==="en" ? "User profile" : "Perfil de usu√°rio"))}</p>
          </div>
        </div>
        <div class="item">
          <span class="dot"></span>
          <div>
            <p class="t">${escapeHtml(currentLang==="en" ? "Selected user" : "Usu√°rio selecionado")}</p>
            <p class="d">${escapeHtml(user?.name || "‚Äî")} ${user?.email ? "‚Ä¢ " + escapeHtml(user.email) : ""}</p>
          </div>
        </div>
      `;

      // Fill docs
      const docs = entity?.docs || {};
      $("#expCpf").value = docs.cpf || "";
      $("#expRne").value = docs.rne || "";
      $("#expCnh").value = docs.cnh || "";
      $("#expHouse").value = docs.house || "";
      $("#expPassport").value = docs.passport || "";

      // Feed
      const act = (db.activity || []).slice(0, 12);
      feed.innerHTML = act.length ? act.map(a => {
        const when = new Date(a.at).toLocaleString();
        return `
          <div class="item">
            <span class="dot"></span>
            <div>
              <p class="t">${escapeHtml(a.action)}</p>
              <p class="d">${escapeHtml(a.who || "")} ‚Ä¢ ${escapeHtml(when)}</p>
            </div>
          </div>
        `;
      }).join("") : `
        <div class="item"><span class="dot"></span>
          <div><p class="t">${escapeHtml(currentLang==="en"?"No activity yet":"Sem atividade ainda")}</p>
          <p class="d">${escapeHtml(currentLang==="en"?"Changes will appear here.":"As altera√ß√µes aparecer√£o aqui.")}</p></div>
        </div>
      `;
    }

    function expBind(){
      // Sidebar collapse
      $("#expToggleSideBtn")?.addEventListener("click", () => {
        $("#expSide")?.classList.toggle("collapsed");
      });

      // Tabs
      document.querySelectorAll(".exp-tab").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".exp-tab").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");

          const tab = btn.getAttribute("data-exp-tab");
          $("#expTab-dados").style.display = (tab === "dados") ? "block" : "none";
          $("#expTab-atividade").style.display = (tab === "atividade") ? "block" : "none";
        });
      });

      // Select user/family
      document.addEventListener("click", (e) => {
        const u = e.target.closest("[data-exp-user]");
        if (u){
          expState.selectedUserId = u.getAttribute("data-exp-user");
          expState.mode = "user";
          expState.selectedMemberId = null;
          expRender();
        }
        const m = e.target.closest("[data-exp-family]");
        if (m){
          expState.selectedMemberId = m.getAttribute("data-exp-family");
          expState.mode = "family";
          expRender();
        }
      });

      // Add user
      $("#expAddUserForm")?.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!expIsAdmin()) return;

        const name = ($("#expNewUserName").value || "").trim();
        const email = ($("#expNewUserEmail").value || "").trim().toLowerCase();
        if (!name || !email) return;

        const db = expLoad();
        const exists = db.users.some(u => (u.email||"").toLowerCase() === email);
        if (exists){
          toast(currentLang==="en" ? "Already exists" : "J√° existe", email, "info");
          return;
        }

        const id = crypto?.randomUUID ? crypto.randomUUID() : ("u_" + Math.random().toString(16).slice(2));
        db.users.push({ id, name, email, photoDataUrl:"", docs:{}, family:[], updatedAt: Date.now() });
        expSave(db);

        expState.selectedUserId = id;
        expState.mode = "user";
        expState.selectedMemberId = null;

        $("#expNewUserName").value = "";
        $("#expNewUserEmail").value = "";

        expLog(currentLang==="en" ? "User profile created" : "Perfil de usu√°rio criado", name);
        toast(t("toastAdded"), name, "success");
        expRender();
      });

      // Add family
      $("#expAddFamilyForm")?.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!expIsAdmin()) return;

        const userId = expState.selectedUserId;
        if (!userId){
          toast(currentLang==="en" ? "Select a user first" : "Selecione um usu√°rio", "", "danger");
          return;
        }

        const name = ($("#expNewFamilyName").value || "").trim();
        const relation = ($("#expNewFamilyRelation").value || "").trim();
        if (!name || !relation) return;

        const db = expLoad();
        const user = db.users.find(u => u.id === userId);
        if (!user) return;

        const id = crypto?.randomUUID ? crypto.randomUUID() : ("f_" + Math.random().toString(16).slice(2));
        user.family = user.family || [];
        user.family.push({ id, name, relation, photoDataUrl:"", docs:{}, updatedAt: Date.now() });
        user.updatedAt = Date.now();
        expSave(db);

        expState.mode = "family";
        expState.selectedMemberId = id;

        $("#expNewFamilyName").value = "";
        $("#expNewFamilyRelation").value = "";

        expLog(currentLang==="en" ? "Family profile added" : "Perfil de familiar adicionado", name);
        toast(t("toastAdded"), name, "success");
        expRender();
      });

      // Save docs
      $("#expSaveBtnNew")?.addEventListener("click", () => {
        if (!expIsAdmin()) return;

        const db = expLoad();
        const { user, member } = expGetSelected(db);
        const entity = (expState.mode === "family") ? member : user;
        if (!entity){
          toast(currentLang==="en" ? "Nothing selected" : "Nada selecionado", "", "info");
          return;
        }

        entity.docs = entity.docs || {};
        entity.docs.cpf = ($("#expCpf").value || "").trim();
        entity.docs.rne = ($("#expRne").value || "").trim();
        entity.docs.cnh = ($("#expCnh").value || "").trim();
        entity.docs.house = ($("#expHouse").value || "").trim();
        entity.docs.passport = ($("#expPassport").value || "").trim();
        entity.updatedAt = Date.now();
        if (expState.mode === "family" && user) user.updatedAt = Date.now();

        expSave(db);
        expLog(currentLang==="en" ? "Profile updated" : "Perfil atualizado", entity.name || "");
        toast(t("toastSaved"), currentLang==="en" ? "Changes saved" : "Altera√ß√µes salvas", "success");
        expRender();
      });

      // Photo add/remove
      $("#expAddPhotoBtn")?.addEventListener("click", () => $("#expPhotoInput").click());

      $("#expPhotoInput")?.addEventListener("change", async () => {
        const f = $("#expPhotoInput").files?.[0];
        if (!f) return;

        const dataUrl = await readFileAsDataURL(f);

        const db = expLoad();
        const { user, member } = expGetSelected(db);
        const entity = (expState.mode === "family") ? member : user;
        if (!entity) return;

        entity.photoDataUrl = dataUrl;
        entity.updatedAt = Date.now();
        if (expState.mode === "family" && user) user.updatedAt = Date.now();

        expSave(db);
        expLog(currentLang==="en" ? "Photo updated" : "Foto atualizada", entity.name || "");
        toast(t("toastSaved"), currentLang==="en" ? "Photo saved" : "Foto salva", "success");
        expRender();
      });

      $("#expRemovePhotoBtn")?.addEventListener("click", () => {
        const db = expLoad();
        const { user, member } = expGetSelected(db);
        const entity = (expState.mode === "family") ? member : user;
        if (!entity) return;

        entity.photoDataUrl = "";
        entity.updatedAt = Date.now();
        if (expState.mode === "family" && user) user.updatedAt = Date.now();

        expSave(db);
        expLog(currentLang==="en" ? "Photo removed" : "Foto removida", entity.name || "");
        toast(t("toastRemoved"), currentLang==="en" ? "Photo removed" : "Foto removida", "info");
        expRender();
      });

      // Delete profile (user or family)
      $("#expDeleteProfileBtn")?.addEventListener("click", () => {
        if (!expIsAdmin()) return;

        const db = expLoad();

        if (expState.mode === "family"){
          const { user, member } = expGetSelected(db);
          if (!user || !member) return;

          user.family = (user.family || []).filter(m => m.id !== member.id);
          user.updatedAt = Date.now();
          expSave(db);

          expLog(currentLang==="en" ? "Family profile removed" : "Perfil de familiar removido", member.name || "");
          toast(t("toastRemoved"), member.name || "", "info");

          expState.mode = "user";
          expState.selectedMemberId = null;
          expRender();
          return;
        }

        const userId = expState.selectedUserId;
        const user = db.users.find(u => u.id === userId);
        if (!user) return;

        db.users = db.users.filter(u => u.id !== userId);
        expSave(db);

        expLog(currentLang==="en" ? "User profile removed" : "Perfil de usu√°rio removido", user.name || "");
        toast(t("toastRemoved"), user.name || "", "info");

        expState.selectedUserId = db.users[0]?.id || null;
        expState.mode = "user";
        expState.selectedMemberId = null;
        expRender();
      });

      $("#expUserSearch")?.addEventListener("input", () => expRender());
    }

    /* ===============================
       DOCUMENTS (fixed - no white screen)
       =============================== */
    const docSearch = $("#docSearch");
    const docCards = $("#docCards");

    const documents = [
      { id:"pol_001", tag:{pt:"Pol√≠tica", en:"Policy"}, title:{pt:"Pol√≠tica de Seguran√ßa da Informa√ß√£o", en:"Information Security Policy"}, desc:{pt:"Diretrizes e responsabilidades de seguran√ßa.", en:"Security guidelines and responsibilities."} },
      { id:"frm_014", tag:{pt:"Formul√°rio", en:"Form"}, title:{pt:"Formul√°rio de Solicita√ß√£o Interna", en:"Internal Request Form"}, desc:{pt:"Modelo padr√£o para solicita√ß√µes.", en:"Standard template for requests."} },
      { id:"man_006", tag:{pt:"Manual", en:"Manual"}, title:{pt:"Manual de Integra√ß√£o (Onboarding)", en:"Onboarding Manual"}, desc:{pt:"Passo a passo para novos colaboradores.", en:"Step-by-step for new employees."} },
      { id:"pol_022", tag:{pt:"Pol√≠tica", en:"Policy"}, title:{pt:"Pol√≠tica de Viagens e Despesas", en:"Travel & Expenses Policy"}, desc:{pt:"Regras para viagens corporativas.", en:"Rules for corporate travel."} },
      { id:"gui_101", tag:{pt:"Guia", en:"Guide"}, title:{pt:"Guia de Acesso ao Portal", en:"Portal Access Guide"}, desc:{pt:"Como usar o menu, recursos e atalhos.", en:"How to use the menu, features, and shortcuts."} },
      { id:"chk_210", tag:{pt:"Checklist", en:"Checklist"}, title:{pt:"Checklist Expatria√ß√£o", en:"Expatriation Checklist"}, desc:{pt:"Lista de etapas e documentos.", en:"List of steps and documents."} },
    ];

    function renderDocs(query=""){
      if (!docCards) return;
      const q = (query || "").trim().toLowerCase();

      const filtered = documents.filter(d => {
        const title = (currentLang==="en" ? d.title.en : d.title.pt).toLowerCase();
        const desc  = (currentLang==="en" ? d.desc.en : d.desc.pt).toLowerCase();
        const tag   = (currentLang==="en" ? d.tag.en : d.tag.pt).toLowerCase();
        return !q || title.includes(q) || desc.includes(q) || tag.includes(q);
      });

      docCards.innerHTML = "";
      if (!filtered.length){
        docCards.innerHTML = `
          <div class="card" style="cursor:default;">
            <div class="icon" aria-hidden="true">?</div>
            <h3>${escapeHtml(t("docsNoResultsTitle"))}</h3>
            <p>${escapeHtml(t("docsNoResultsDesc"))}</p>
          </div>`;
        return;
      }

      filtered.forEach(d => {
        const tag = currentLang==="en" ? d.tag.en : d.tag.pt;
        const title = currentLang==="en" ? d.title.en : d.title.pt;
        const desc  = currentLang==="en" ? d.desc.en : d.desc.pt;

        const el = document.createElement("div");
        el.className = "card";
        el.setAttribute("tabindex","0");
        el.innerHTML = `
          <div class="icon" aria-hidden="true">${escapeHtml(tag.slice(0,3).toUpperCase())}</div>
          <h3>${escapeHtml(title)}</h3>
          <p>${escapeHtml(desc)}</p>
          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; position:relative; z-index:1;">
            <span class="chip">${escapeHtml(tag)}</span>
            <a class="btn btn-ghost" href="javascript:void(0)" data-doc-open="${escapeHtml(d.id)}">
              <span aria-hidden="true">üîé</span> ${escapeHtml(t("docsOpen"))}
            </a>
          </div>
        `;
        docCards.appendChild(el);
      });
    }

    document.addEventListener("click", (e) => {
      const a = e.target.closest("[data-doc-open]");
      if (!a) return;
      const id = a.dataset.docOpen;
      toast(currentLang==="en" ? "Document (demo)" : "Documento (demo)",
            (currentLang==="en" ? "Open item: " : "Abrir item: ") + id,
            "info", 2400);
    });

    docSearch?.addEventListener("input", () => renderDocs(docSearch.value));

    /* ===============================
       SUPPORT (demo)
       =============================== */
    const supportForm = $("#supportForm");
    supportForm?.addEventListener("submit", (e) => {
      e.preventDefault();
      const title = ($("#supTitleInput").value || "").trim();
      const desc = ($("#supDesc").value || "").trim();
      if (!title || !desc){
        toast(t("toastRequired"), currentLang==="en" ? "Fill in title and description." : "Preencha t√≠tulo e descri√ß√£o.", "danger");
        return;
      }
      $("#supTitleInput").value = "";
      $("#supDesc").value = "";
      toast(currentLang==="en" ? "Sent (demo)" : "Enviado (demo)",
            currentLang==="en" ? "Your request was saved locally (simulation)." : "Sua solicita√ß√£o foi registrada localmente (simula√ß√£o).",
            "success", 3200);
    });

    /* ===============================
       Init
       =============================== */
    applyI18n();

    const existing = getSession();
    if (existing?.email){
      enterApp(existing);
    } else {
      $("#langSelectLogin").value = currentLang;
      $("#langSelectApp").value = currentLang;
    }

    // Default initial renders
    renderJournal();
    renderDocs("");
  </script>
</body>
</html>
